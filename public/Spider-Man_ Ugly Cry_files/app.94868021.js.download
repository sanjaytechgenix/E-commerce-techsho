!function(){"use strict";var app=angular.module("vlipsyApp",["ui.router","ui.bootstrap","ui.utils","ui.select","satellizer","ngTagsInput","ngMessages","LocalStorageModule","ngSanitize","angular-jwt","angularMoment","ngclipboard","meta","shell","auth","search","results","account","upload","profile","vlip","share","meme"]);app.provider("appProvider",function(){this.appMaintenanceMode=!1,this.mobileBrowser=!1,this.$get=function(){var self=this;return{isMobileBrowser:self.mobileBrowser,maintenance:self.appMaintenanceMode}}}),app.factory("errorInterceptor",["$q","$rootScope","$location","localStorageService","User",function($q,$rootScope,$location,localStorageService,User){return{request:function(config){return config||$q.when(config)},requestError:function(request){return $q.reject(request)},response:function(response){return response||$q.when(response)},responseError:function(response){return response&&401===response.status&&response.data.message&&"Invalid Token"==response.data.message&&(User.destroy(),localStorageService.clearAll(),$location.path("/signin")),response&&response.status,response&&response.status,$q.reject(response)}}}]),app.config(["$urlRouterProvider","$locationProvider","$authProvider","$logProvider","$httpProvider","$sceDelegateProvider","appProviderProvider","API","SOCIAL_APPS","GOOGLE_ANALYTICS_KEY",function($urlRouterProvider,$locationProvider,$authProvider,$logProvider,$httpProvider,$sceDelegateProvider,appProviderProvider,API,SOCIAL_APPS,GOOGLE_ANALYTICS_KEY){appProviderProvider.mobileBrowser=function(){var check=!1;return function(a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0)}(navigator.userAgent||navigator.vendor||window.opera),window.innerWidth<=520&&(check=!0),check}(),/bot|google|baidu|bing|msn|duckduckgo|facebookexternalhit|facebot|teoma|slurp|prerender|yandex/i.test(navigator.userAgent)&&amplitude.getInstance().setOptOut(!0),$sceDelegateProvider.resourceUrlWhitelist(["self","https://assets.vlipsy.com/**","https://media.vlipsy.com/**"]),window.history&&window.history.pushState?($locationProvider.html5Mode(!0).hashPrefix("!"),$urlRouterProvider.otherwise(function($injector,$location){var url=$location.url(),$state=$injector.get("$state");if(0===url.lastIndexOf("/")){var searchTerm=url.substring(1,url.length);$state.go("app.tag",{term:searchTerm})}else $state.go("app.404")})):(window.location.hash="/",$locationProvider.html5Mode(!0)),$logProvider.debugEnabled(!1),$urlRouterProvider.when("/account/","/account/settings"),$urlRouterProvider.when("","/"),$httpProvider.interceptors.push("errorInterceptor"),$authProvider.facebook({clientId:SOCIAL_APPS.facebook,url:API.url+"/auth/facebook?key="+API.key,responseType:"token"}),$authProvider.twitter({url:"/auth/twitter"}),$authProvider.loginUrl=API.url+"/auth?key="+API.key,ga("create",GOOGLE_ANALYTICS_KEY,"auto"),amplitude.getInstance().logEvent("App Opened",{Client:"Vlipsy.com"})}]).run(["$rootScope","$location","$state","$stateParams","$auth","appProvider","User","MetaData","Auth","State","Metrics","AUTH_EVENTS","APP_EVENTS",function($rootScope,$location,$state,$stateParams,$auth,appProvider,User,MetaData,Auth,State,Metrics,AUTH_EVENTS,APP_EVENTS){if(appProvider.isMobileBrowser&&"/"==$location.path()&&"true"==$location.search().share){var userAgent=navigator.userAgent||navigator.vendor||window.opera;if(/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream)return void window.location.replace("https://itunes.apple.com/us/app/vlipsy/id1288203847?ls=1&mt=8");if(/android/i.test(userAgent))return void window.location.replace("https://play.google.com/store/apps/details?id=com.vlipsy.android")}if(User.data&&User.data._id){amplitude.getInstance().setUserId(User.data._id);var identify=(new amplitude.Identify).set("Username",User.data.username).set("Email",User.data.email).set("Display Name",User.data.display_name).set("Vlips Created",User.data.vlip_count);User.data.producer&&identify.set("Producer",!0),User.data.wkwii&&identify.set("Vlipsy Team",!0),amplitude.identify(identify)}$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if(appProvider.maintenance&&"auth.maintenance"!==toState.name)return void window.location.replace(window.location.origin+"/maintenance");appProvider.isMobileBrowser&&$rootScope.$broadcast(APP_EVENTS.showLoader,!0),"signout"==toState.name&&(event.preventDefault(),Auth.logout(),$state.go("app.home",null,{reload:!0}).then(function(){$rootScope.$broadcast(AUTH_EVENTS.logoutSuccess)})),"signin"==toState.name&&(event.preventDefault(),Auth.isLoggedInAsync(function(loggedIn){return loggedIn?""==fromState.name?void $state.go("app.home"):void $state.go(fromState.name,fromParams,{reload:!0}):void $state.go(toState.name,toParams,{notify:!1}).then(function(){$rootScope.$broadcast("$stateChangeSuccess",toState,toParams,fromState,fromParams)})})),MetaData.setData(toState),toState.privateview&&(event.preventDefault(),$auth.isAuthenticated()?$state.go(toState.name,toParams,{notify:!1}).then(function(){$rootScope.$broadcast("$stateChangeSuccess",toState,toParams,fromState,fromParams)}):(State.set(toState,toParams),Auth.logout(),$state.go("auth.signin")))}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$rootScope.$broadcast(APP_EVENTS.showLoader,!1),State.setPrevious(fromState,fromParams),MetaData.setURL(),window.scrollTo(0,0),window.prerenderReady=!0,ga("send","pageview",window.location.pathname),-1===["app.tag","app.vlip","app.search-page","app.playlist","app.upload"].indexOf(toState.name)&&Metrics.pageViewed()}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){$state.go("app.404")}),$rootScope.$on("$stateNotFound",function(event,unfoundState,fromState,fromParams){})}])}(),angular.module("vlipsyApp").constant("CREATE_ENABLED",!0).constant("META",{title:"Vlipsy | Search for Video Clips & Make Your Own Reaction Clip",description:"Vlipsy is the top source for the best video clips (vlips) for chat and social media. Find funny video clips and other reaction clips to use them like a GIF with sound.",keywords:"Video Clips, funny clips, love clips, reaction clips, chat clips, messenger clips, GIFs with sound, Audio GIFs, GIFs with audio, Video clip search engine, video clip soundboard, soundboard, vlips, videos, clips, flicks, qwip, video segments, expression, GIFs, animated GIFs, best video clips, happy clips, sad clips, birthday clips, yes clips, no clips, memes"}).constant("API",{url:"https://apiv2.vlipsy.com/v1",key:"vl_R8daJGhs67i7Ej7y"}).constant("PER_PAGE_LIMIT",80).constant("YOUTUBE_API_KEY","AIzaSyAh-0oM1iba4Qe_gaKeECS2TisBW5SyohY").constant("SOCIAL_APPS",{facebook:"180400799051034",twitter:"13374293",pinterest:"4882252939336365223"}).constant("APP_EVENTS",{alert:"app-alert",creatorHeaderChange:"creator-header-change",creatorNavigation:"creator-navigation",creatorTip:"creator-tip",focusSearch:"focus-search",hideSearch:"hide-search",getVideoTimes:"get-video-times",getVideoThumb:"get-video-thumb",memeReady:"meme-ready",metaUpdated:"meta-updated",newVlip:"new-vlip",posterReady:"poster-ready",resendVerification:"resend-verification",showLoader:"show-loader",sortBarToggle:"sort-bar-toggle",swipeChange:"swipeChange",userUpdated:"user-updated",uploadCallback:"upload-callback",watchAll:"watch-all"}).constant("AUTH_EVENTS",{authenticated:"auth-authenticated",loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("DEFAULT_ALERT_TIME",5e3).constant("FORM_ERROR",{alert:{msg:"Whoops! There was an issue with your submission. Please try again.",timeout:!1}}).constant("USER_ROLES",{user:"user",artist:"artist"}).constant("SERVICE_URL","/s").constant("VIDEO_URL","https://video.vlipsy.com/video/").constant("VIDEO_THEME","app/lib/videogular.min.css").constant("DEFAULT_AVATAR","https://assets.vlipsy.com/images/default-profile-pic.png").constant("PASSWORD_REGEX",/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[a-zA-Z0-9]{8,30}$/).constant("PHONE_REGEX",/^([0-9\(\)\/\+ \-]*)$/).constant("USERNAME_REGEX",/^[a-zA-Z0-9_.-]{3,24}$/).constant("ACCOUNT_LINKS",["app.account"]).constant("GOOGLE_ANALYTICS_KEY","UA-93927060-2").constant("CREATOR_TIPS",{startingPoint:{title:"Select Starting Point",body:"The source video is longer than 30 seconds.<br>Begin by selecting the starting point above."},clipVideo:{title:"Clip Video",body:"Create a clip between 1-30 seconds using the selectors above. Use the +/- controls for decimals."},thumb:{title:"Select Thumbnail",body:"Use the selector above to set the thumbnail for your vlip."}}).constant("CREATOR_HEADERS",[{left:"close",center:"Set Start Time",right:"next"},{left:"back",center:"Clip Video",right:"clip"},{left:"back",center:"Set Thumbnail",right:{action:"thumb",btnLabel:"done"}},{left:"back",center:"Finalize & Save",right:"save"}]).constant("ALERTS",{verifyAccountSuccess:{title:"Email Verified",msg:"Your email has been verified. You can now create your own vlips!",btn:"Woo hoo!",icon:"fas fa-check",error:!1,autoClose:!0},verifyAccountError:{title:"Verification Failed",msg:'Verification failed. Please try again or <a ng-click="resendVerification()">request a new verification email</a>.',btn:"Dismiss",icon:"fas fa-exclamation",error:!0},verifyAccountSend:{title:"Verify Email",msg:"Please click the link in email we just sent to verify your email.",btn:"Okay",icon:"fal fa-envelope-open-text",autoClose:!0},avatarTooSmall:{title:"Too Small",msg:"The image you uploaded is too small. Please use one that is at least 250x250.",btn:"Got it",icon:"far fa-image",error:!0},settingsSuccess:{title:"Great Success!",msg:"Your settings have been updated.",btn:"Nice",icon:"fas fa-smile-beam",autoClose:!0},passwordChangeFail:{title:"Try again",msg:"Please reenter your old password and try again.",btn:"Dismiss",icon:"fas fa-exclamation",error:!0},accountAlreadyExists:{title:"Duplicate Email",msg:'An account with this email already exists. Did you mean to <a ng-click="login()">login</a>?',btn:"Dismiss",icon:"fas fa-exclamation",error:!0},uploadTitle:{title:"Missing Title",msg:"Your vlip is awesome, but it needs a name. Add a title and submit again.",btn:"Got it",icon:"far fa-file-signature",error:!0},uploadSource:{title:"Where's this from?",msg:"Tell us where this clip is from (ex. TV Show, Movie, Creator Name) and submit again.",btn:"Got it",icon:"far fa-question",error:!0},uploadTags:{title:"Add Tag",msg:"Add at least one tag to your vlip and submit again.",btn:"Got it",icon:"fas fa-tag",error:!0},uploadBadLink:{title:"Failed to Download",msg:"Failed to download video from server. The source link is restricted.",btn:"Dismiss",icon:"fas fa-unlink",error:!0},connectionError:{title:"Connection Error",msg:"There was a problem connecting to the server, please refresh your browser.",btn:"Refresh",icon:"fas fa-plug",error:!0,refresh:!0},somethingWentWrong:{title:"Oh no",msg:'Something went wrong with your last request. Refresh your browser and try again. If the problem persists, email us at <a href="mailto:support@vlipsy.com" target="_blank>support@vlipsy.com</a>.',btn:"Dismiss",icon:"far fa-frown-open",error:!0}});var accountModule=angular.module("account",["ngFileUpload"]);accountModule.config(["$stateProvider",function($stateProvider){$stateProvider.state("app.account",{abstract:!0,controller:["$scope","$state","appProvider",function($scope,$state,appProvider){$scope.title=$state.current.title,appProvider.isMobileBrowser&&$scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$scope.title=toState.title})}],templateProvider:["$http","appProvider",function($http,appProvider){var template=appProvider.isMobileBrowser?"account/views/account-mobile.html":"account/views/account.html";return $http.get(template).then(function(tpl){return tpl.data})}]}).state("app.account.settings",{url:"/account/settings?activate",templateProvider:["$http","appProvider",function($http,appProvider){var template=appProvider.isMobileBrowser?"account/views/settings-mobile.html":"account/views/settings.html";return $http.get(template).then(function(tpl){return tpl.data})}],controller:"accountCtrl",data:{title:"Edit Profile · Vlipsy"},params:{activate:{value:null,squash:!0}},title:"Account",resolve:{user:["$stateParams","Account","User",function($stateParams,Account,User){return Account.getUser().then(function(user){return User.setUser(user),$stateParams.activate?Account.activateUser($stateParams.activate).then(function(res){return user.activated=!0,user},function(err){return user.activated=!1,user}):user},function(err){return{}})}]},privateview:!0}).state("app.account.password",{url:"/account/password/change",templateUrl:"account/views/password.html",controller:"passwordCtrl",title:"Change Password",data:{title:"Change Password · Vlipsy"},privateview:!0}).state("app.account.username",{url:"/account/username",templateUrl:"account/views/username.html",controller:"accountCtrl",title:"Change username",data:{title:"Change Username · Vlipsy"},resolve:{user:["User",function(User){return User.data}]},privateview:!0}).state("app.account.email",{url:"/account/email",templateUrl:"account/views/email.html",controller:"accountCtrl",title:"Change email",data:{title:"Change Email · Vlipsy"},resolve:{user:["User",function(User){return User.data}]},privateview:!0}).state("app.account.profile",{url:"/account/profile",templateUrl:"account/views/edit-profile.html",controller:"accountCtrl",title:"Edit profile",data:{title:"Edit Profile · Vlipsy"},resolve:{user:["User",function(User){return User.data}]},privateview:!0})}]);var authModule=angular.module("auth",[]);authModule.config(["$stateProvider",function($stateProvider){$stateProvider.state("auth",{abstract:!0,templateUrl:"auth/views/main.html"}).state("auth.signup",{url:"/signup/:key",templateUrl:"auth/views/signup.html",controller:"authCtrl",title:"Registration"}).state("auth.signin",{url:"/signin",templateUrl:"auth/views/signin.html",controller:"authCtrl",title:"Sign In"}).state("signout",{url:"/logout",title:"Sign Out"}).state("auth.forgot",{url:"/forgot-password",templateUrl:"auth/views/forgot.html",controller:"authCtrl",title:"Forgot Password"}).state("auth.reset",{url:"/reset-password/:key",templateUrl:"auth/views/resetPassword.html",controller:"authCtrl",title:"Reset Password"}).state("auth.username",{url:"/confirm-username",templateUrl:"auth/views/confirmUsername.html",controller:"authCtrl",title:"Confirm Username"}).state("auth.maintenance",{url:"/maintenance",controller:"errorPageCtrl",templateUrl:"auth/views/maintenance.html",title:"Maintenance",data:{title:"Site Maintenance · Vlipsy"}})}]);var memeModule=angular.module("meme",[]),metaModule=angular.module("meta",[]);metaModule.config(["$stateProvider",function($stateProvider){$stateProvider.state("embed",{url:"/embed/:id",controller:"embedCtrl",templateUrl:"/meta/views/embed.html",title:"Embed",resolve:{vlip:["$stateParams","$state","Vlips","MetaData",function($stateParams,$state,Vlips,MetaData){return Vlips.getVlipByID($stateParams.id).then(function(vlip){return MetaData.setFromVlip(vlip),vlip}).catch(function(e){return $state.go("app.500"),null})}]}})}]);var profileModule=angular.module("profile",[]);profileModule.config(["$stateProvider",function($stateProvider){$stateProvider.state("app.user",{abstract:!0,templateProvider:["$http","appProvider",function($http,appProvider){var template=appProvider.isMobileBrowser?"profile/views/profile-mobile.html":"profile/views/profile.html";return $http.get(template).then(function(tpl){return tpl.data})}],controller:"profileCtrl",params:{username:{value:null,squash:!0},page:{value:"1",squash:!0}},resolve:{user:["$state","$stateParams","Profile","MetaData",function($state,$stateParams,Profile,MetaData){$stateParams.page&&$stateParams.page;return Profile.getUser($stateParams.username).then(function(user){return MetaData.setFromProfile(user),user}).catch(function(err){return null})}]}}).state("app.user.vlips",{url:"/u/:username?page",templateUrl:"profile/views/user-vlips.html",controller:"profileVlipsCtrl",params:{username:{value:null,squash:!0},page:{value:"1",squash:!0}},title:"User Profile",resolve:{vlips:["$state","$stateParams","$filter","Profile",function($state,$stateParams,$filter,Profile){var page=$stateParams.page?$stateParams.page-1:null;return Profile.getVlips($stateParams.username,page).then(function(response){return $filter("addTrackingProperties")(response,{type:"profile",source:$stateParams.username})}).catch(function(err){return{data:[]}})}]}}).state("app.user.favorites",{url:"/u/:username/favorites?page",templateUrl:"profile/views/user-vlips.html",controller:"profileVlipsCtrl",params:{username:{value:null,squash:!0},page:{value:"1",squash:!0}},title:"User Favorites",resolve:{vlips:["$state","$stateParams","$filter","Vlips",function($state,$stateParams,$filter,Vlips){var page=$stateParams.page?$stateParams.page-1:null;return Vlips.getFavorites($stateParams.username,page).then(function(response){return $filter("addTrackingProperties")(response,{type:"favorites",source:$stateParams.username})},function(err){return $state.go("app.404"),null})}]}})}]),function(){angular.module("results",["ng-clamp","com.2fdevs.videogular"]).config(["$stateProvider",function($stateProvider){$stateProvider.state("app.home",{url:"/",template:"<ui-view></ui-view>",params:{page:{value:0,squash:!0}},title:"Home",controller:["$state","$stateParams","appProvider",function($state,$stateParams,appProvider){appProvider.isMobileBrowser?$state.go("app.home.mobile",$stateParams):$state.go("app.home.desktop",$stateParams)}]}).state("app.home.desktop",{url:"",templateUrl:"results/views/browse.html",controller:"homeCtrl",title:"Home",params:{page:{value:"1",squash:!0}},resolve:{playlists:["Vlips",function(Vlips){return Vlips.getPlaylists().then(function(playlists){return playlists.data},function(err){return null})}]}}).state("app.home.mobile",{url:"?tab",templateUrl:"results/views/browse-mobile.html",controller:"homeMobileCtrl",params:{tab:{value:"trending",squash:!0},page:{value:"1",squash:!0}},title:"Home",resolve:{vlips:["$state","$stateParams","Vlips",function($state,$stateParams,Vlips){var page=$stateParams.page?$stateParams.page-1:null;return Vlips.get("low",page).then(function(response){return response},function(err){return $state.go("app.500"),null})}]}})}])}();var searchModule=angular.module("search",[]),searchDataCalls={results:["$location","$stateParams","$filter","MetaData","Search",function($location,$stateParams,$filter,MetaData,Search){var term=$filter("flattenSearchTerm")($stateParams.term);term||($location.path("/404"),$scope.$apply());var page=$stateParams.page?$stateParams.page-1:null,exact=$stateParams.exact;return Search.getResults(term,$stateParams.raw,exact,page).then(function(response){return MetaData.setFromSearch(term,response.data),response.term=term,response.type="search",$filter("addTrackingProperties")(response,{type:"search",source:term})},function(err){return{data:[],term:term,pagination:{total_count:0}}})}]},params={page:{value:"1",squash:!0},term:{value:null,squash:!0},exact:{value:null,squash:!0},raw:{value:null}};searchModule.config(["$stateProvider","$urlMatcherFactoryProvider",function($stateProvider,$urlMatcherFactoryProvider){var searchTermType={encode:function(str){return str&&str.replace(/ /g,"-")},decode:function(str){return str&&str.replace(/-/g," ")},is:angular.isString,pattern:/[^\/]+/};$urlMatcherFactoryProvider.type("searchTerm",searchTermType),$stateProvider.state("app.tag",{url:"/search/{term:searchTerm}?exact",params:params,templateProvider:["$http","appProvider",function($http,appProvider){var template=appProvider.isMobileBrowser?"search/views/search-mobile.html":"search/views/search.html";return $http.get(template).then(function(tpl){return tpl.data})}],controller:"searchCtrl",title:"Search",resolve:searchDataCalls}).state("app.search-page",{url:"/search/:term/:page?exact",params:params,templateProvider:["$http","appProvider",function($http,appProvider){var template=appProvider.isMobileBrowser?"search/views/search-mobile.html":"search/views/search.html";return $http.get(template).then(function(tpl){return tpl.data})}],controller:"searchCtrl",title:"Search",resolve:searchDataCalls}).state("app.playlist",{url:"/playlist/:slug?page",params:{slug:{value:null,squash:!0},page:{value:"1",squash:!0}},templateProvider:["$http","appProvider",function($http,appProvider){var template=appProvider.isMobileBrowser?"search/views/search-mobile.html":"search/views/search.html";return $http.get(template).then(function(tpl){return tpl.data})}],controller:"searchCtrl",title:"Playlist",resolve:{results:["$stateParams","$filter","MetaData","Metrics","Vlips",function($stateParams,$filter,MetaData,Metrics,Vlips){var page=$stateParams.page?$stateParams.page-1:null,idx=$stateParams.slug.lastIndexOf("-"),id=$stateParams.slug.substring(idx+1,$stateParams.slug.length),obj={};return Vlips.getPlaylistInfo(id).then(function(info){return obj=info,obj.type="playlist",Vlips.getPlaylistVlips(obj,page)}).then(function(response){return obj.data=response.data,obj.pagination=response.pagination,0==response.pagination.offset&&Metrics.logPlaylistView(id,obj.title),MetaData.setFromPlaylist(obj,$stateParams.slug,response.data),obj}).catch(function(err){return obj})}]}}).state("app.trending",{url:"/trending?page",params:{page:{value:"1",squash:!0}},templateUrl:"search/views/search.html",controller:"searchCtrl",title:"Trending",resolve:{results:["$stateParams","MetaData","Metrics","Vlips",function($stateParams,MetaData,Metrics,Vlips){var page=$stateParams.page?$stateParams.page-1:null;return Vlips.get("low",page).then(function(response){return MetaData.setFromTrending(response.data),0==response.pagination.offset&&Metrics.pageViewed(),response.title="Trending Vlips",response.type="trending",response}).catch(function(err){return{data:[],term:"Trending Vlips"}})}]}}).state("app.related",{url:"/related/:id?page",params:{page:{value:"1",squash:!0}},templateUrl:"search/views/search.html",controller:"searchCtrl",title:"Related",resolve:{results:["$stateParams","$filter","MetaData","Metrics","Vlips",function($stateParams,$filter,MetaData,Metrics,Vlips){return Vlips.getRelatedVlips($stateParams.id).then(function(related){MetaData.setFromRelated(related.data,$stateParams.id);var results=$filter("addTrackingProperties")(related,{type:"related",source:$stateParams.id});return 0==related.pagination.offset&&Metrics.pageViewed(),results.title="Related Vlips",results.type="related",results}).catch(function(err){return{data:[],term:"Related Vlips"}})}]}})}]);var shareModule=angular.module("share",["ngclipboard"]),shellModule=angular.module("shell",[]);shellModule.config(["$stateProvider",function($stateProvider){$stateProvider.state("app",{abstract:!0,controller:"shellCtrl",templateProvider:["$http","appProvider",function($http,appProvider){var template=appProvider.isMobileBrowser?"shell/views/shell-mobile.html":"shell/views/shell.html";return $http.get(template).then(function(tpl){return tpl.data})}],params:{upload:{squash:!0,value:!1}}}).state("app.aux",{abstract:!0,template:'<div id="aux" class="alt-bg"><div class="container" ui-view></div></div>'}).state("app.aux.terms",{url:"/terms",templateUrl:"shell/views/terms.html",title:"Terms of Service",data:{title:"Terms of Service · Vlipsy"}}).state("app.aux.privacy",{url:"/privacy",templateUrl:"shell/views/privacy.html",title:"Privacy Policy",data:{title:"Privacy Policy · Vlipsy"}}).state("app.aux.dmca",{url:"/dmca",templateUrl:"shell/views/dmca.html",title:"DMCA",data:{title:"DMCA · Vlipsy"}}).state("app.aux.api",{url:"/developers/api",title:"API",data:{title:"Developer API · Vlipsy"}}).state("app.aux.support",{url:"/support",templateUrl:"shell/views/help.html",title:"Support",data:{title:"Help & Support · Vlipsy"}}).state("app.aux.faq",{url:"/faq",templateUrl:"shell/views/faq.html",title:"FAQ",data:{title:"FAQs · Vlipsy"}}).state("app.404",{url:"/404",controller:"errorPageCtrl",templateUrl:"shell/views/404.html",title:"404",data:{title:"Page not found · Vlipsy"}}).state("app.500",{url:"/500",controller:"errorPageCtrl",templateUrl:"shell/views/500.html",title:"500",data:{title:"Server Error · Vlipsy"}})}]);var uploadModule=angular.module("upload",["ngSanitize","rzModule","com.2fdevs.videogular","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.poster"]);uploadModule.config(["$stateProvider",function($stateProvider){$stateProvider.state("app.upload",{url:"/upload/:id",templateProvider:["$http","appProvider",function($http,appProvider){var template=appProvider.isMobileBrowser?"upload/views/upload-mobile.html":"upload/views/upload.html";return $http.get(template).then(function(tpl){return tpl.data})}],controller:"uploadCtrl",privateview:!0,title:"Creator",params:{id:null,video:null,src:null},resolve:{data:["$stateParams",function($stateParams){return $stateParams}]}})}]);var vlipModule=angular.module("vlip",["slick"]);vlipModule.config(["$stateProvider",function($stateProvider){$stateProvider.state("app.vlip",{url:"/vlip/:slug",templateProvider:["$http","appProvider",function($http,appProvider){var template=appProvider.isMobileBrowser?"vlip/views/vlipProfile-mobile.html":"vlip/views/vlipProfile.html";return $http.get(template).then(function(tpl){return tpl.data})}],controller:"vlipProfileCtrl",params:{id:null,fresh:!1,position:null,mode:null,source:null,swipe:null},title:"Vlip Profile",resolve:{vlip:["$stateParams","$state","Metrics","Vlips","MetaData","State",function($stateParams,$state,Metrics,Vlips,MetaData,State){var trackingData={position:$stateParams.position,mode:$stateParams.mode||{type:"Link"}};State.setTrackingData(trackingData);var idx=$stateParams.slug.lastIndexOf("-"),id=$stateParams.slug.substring(idx+1,$stateParams.slug.length);return Vlips.getVlipByID(id,$stateParams.swipe).then(function(vlip){var hideDescription=-1==idx;return MetaData.setFromVlip(vlip,hideDescription),this.profile=vlip,Metrics.vlipViewed(this.profile),this.profile},function(e){return"user not found"===e?(this.profile.creator={username:this.profile.user.username,avatar:"https://assets.vlipsy.com/images/default-profile-pic.png"},this.profile):($state.go("app.404"),null)})}],favorited:["$stateParams","appProvider","User","Vlips",function($stateParams,appProvider,User,Vlips){var idx=$stateParams.slug.lastIndexOf("-"),id=$stateParams.slug.substring(idx+1,$stateParams.slug.length);return!(!User.data||void 0===User.data.id)&&Vlips.favoriteCheck(id).then(function(res){return res},function(err){return!1})}],related:["$stateParams","appProvider","$filter","Vlips",function($stateParams,appProvider,$filter,Vlips){var idx=$stateParams.slug.lastIndexOf("-"),id=$stateParams.slug.substring(idx+1,$stateParams.slug.length);return Vlips.getRelatedVlips(id).then(function(related){return this.results=$filter("addTrackingProperties")(related,{type:"related",source:id}),this.results.data.length>0?this.results:Vlips.get("off",0,24)}).then(function(res){return this.results.data=res.data,this.results.pagination=res.pagination,this.results}).catch(function(err){return!1})}]}})}]),function(){"use strict";angular.module("account").controller("accountCtrl",["$scope","$rootScope","$state","$auth","$timeout","User","Account","USERNAME_REGEX","APP_EVENTS","user",function($scope,$rootScope,$state,$auth,$timeout,User,Account,USERNAME_REGEX,APP_EVENTS,user){function showActivationAlert(){var alert=user.activated?"verifyAccountSuccess":"verifyAccountFailed";$rootScope.$broadcast(APP_EVENTS.alert,alert)}$scope.user=user,$scope.channel={private:!1,username:user.username,display_name:user.display_name,about:user.about,social_profiles:user.social_profiles},$scope.processing={email:!1,profile:!1},$scope.initUsername=user.username,$scope.usernameRegex=USERNAME_REGEX,$scope.usernameSearch=!1,$scope.usernameAvailable=null,$scope.social_profiles=null,$scope.aboutMax=160,$scope.checkUsername=function(username){$scope.usernameAvailable=!1,$scope.usernameSearch=!0,Account.checkUsername(username).then(function(res){$scope.usernameSearch=!1,$scope.usernameAvailable=res,$scope.accountForm.username.$setValidity("username",res)}).catch(function(err){})},$scope.updateEmail=function(user){$scope.processing.email=!0,Account.updateEmail(user).then(function(res){$scope.processing.email=!1,$rootScope.$broadcast(APP_EVENTS.alert,"verifyAccountSend")},function(err){$scope.processing.email=!1,$scope.showAlert(!1)})},$scope.updatePrivacy=function(){$scope.channel.private=!$scope.channel.private;var obj={private:$scope.channel.private};Account.updatePrivacy(obj).then(function(res){$scope.showAlert(!0)},function(err){$scope.channel.private=!$scope.channel.private,$scope.showAlert(!1)})},$scope.updateSettings=function(channel){if($scope.initUsername!==channel.username&&($scope.initUsername=channel.username),channel.display_name===User.data.display_name&&channel.username===User.data.username&&channel.about===User.data.about||(channel.changed=!0),channel.social_profiles)for(var key in channel.social_profiles){var username=channel.social_profiles[key];""===username?delete channel.social_profiles[key]:"@"===username.charAt(0)&&(channel.social_profiles[key]=username.substring(1,username.length))}$scope.processing.profile=!0,Account.updateSettings(channel).then(function(res){$scope.showAlert(!0),$scope.usernameAvailable=!1,$scope.processing.profile=!1},function(err){$scope.showAlert(!1),$scope.processing.profile=!1})},$scope.showAlert=function(success,msg){var alert=success?"settingsSuccess":"somethingWentWrong";$rootScope.$broadcast(APP_EVENTS.alert,alert)},null!==$state.params.activate&&$timeout(showActivationAlert,500)}])}(),function(){"use strict";angular.module("account").controller("accountPhotoCtrl",["$scope","$rootScope","$auth","User","Account","API","APP_EVENTS","DEFAULT_AVATAR",function($scope,$rootScope,$auth,User,Account,API,APP_EVENTS,DEFAULT_AVATAR){function uploadAvatar(file){
$scope.loading=!0,Account.uploadAvatar(file).then(function(data){User.setUser({avatar:data.avatar}),$scope.image=data.avatar,$scope.loading=!1},function(err){$scope.loading=!1,$rootScope.$broadcast(APP_EVENTS.alert,"somethingWentWrong")})}var img=User.data.avatar?User.data.avatar:DEFAULT_AVATAR;$scope.image=img,$scope.defaultImg=User.data.avatar==DEFAULT_AVATAR,$scope.avatarFile=null,$scope.loading=!1,$scope.$watch("avatarFile",function(){if($scope.avatarFile){var reader=new FileReader;reader.addEventListener("load",function(){var img=new Image;img.onload=function(){img.width<250&&img.height<250?$rootScope.$broadcast(APP_EVENTS.alert,"avatarTooSmall"):uploadAvatar(reader.result)},img.src=reader.result}),reader.readAsDataURL($scope.avatarFile)}})}])}(),function(){"use strict";angular.module("account").controller("passwordCtrl",["$scope","$rootScope","Auth","APP_EVENTS",function($scope,$rootScope,Auth,APP_EVENTS){$scope.password={},$scope.processing={main:!1},$scope.result=null,$scope.updatePassword=function(password){$scope.processing.main=!0,Auth.changePassword(password).then(function(res){$scope.result=!0,$scope.processing.main=!1,$rootScope.$broadcast(APP_EVENTS.alert,"settingsSuccess"),$scope.password={}},function(err){$rootScope.$broadcast(APP_EVENTS.alert,"passwordChangeFail"),$scope.result=!1,$scope.processing.main=!1})}}])}(),function(){"use strict";angular.module("account").directive("accountPhoto",[function(){return{restrict:"E",replace:!0,templateUrl:"account/views/accountPhoto.html",controller:"accountPhotoCtrl"}}])}(),function(){"use strict";angular.module("account").factory("Account",["$http","$q","$window","$auth","localStorageService","User","API",function($http,$q,$window,$auth,localStorageService,User,API){return{getUser:function(){var deferred=$q.defer();return $http.get(API.url+"/user?key="+API.key).then(function(res){deferred.resolve(res.data)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},activateUser:function(token){var deferred=$q.defer(),obj={token:token};return $http.put(API.url+"/user/confirm?key="+API.key,obj).then(function(data){User.activateUser(),deferred.resolve(data)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},uploadAvatar:function(file){var deferred=$q.defer(),obj={avatar:file};return $http.patch(API.url+"/user/avatar?key="+API.key,obj).then(function(res){deferred.resolve(res.data)},function(res){deferred.reject(res.data)}.bind(this)),deferred.promise},updateEmail:function(user){var deferred=$q.defer();return $http.put(API.url+"/user/email",user).then(function(data){User.setUser(data),deferred.resolve(data)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},updatePrivacy:function(user){var deferred=$q.defer();return $http.put(API.url+"/user/privacy",user).then(function(data){User.setUser(data),deferred.resolve(data)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},updateSettings:function(user){var deferred=$q.defer();return $http.patch(API.url+"/user?key="+API.key,user).then(function(res){res.token&&$auth.setToken(res.token),User.setUser(user),deferred.resolve(user)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},checkUsername:function(username){var deferred=$q.defer();return $http.get(API.url+"/users/"+username+"/available?key="+API.key).then(function(res){deferred.resolve(res.data)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},resendVerificationEmail:function(){var deferred=$q.defer();return $http.post(API.url+"/user/validation?key="+API.key).then(function(res){deferred.resolve(User.data.email)},function(err){deferred.reject(err)}.bind(this)),deferred.promise}}}])}(),function(){"use strict";angular.module("account").service("User",["$rootScope","localStorageService","APP_EVENTS",function($rootScope,localStorageService,APP_EVENTS){return this.init=function(){this.data={}},this.setUser=function(user){this.data||(this.data={}),this.data=_.merge(this.data,user),localStorageService.set("currentUser",this.data),$rootScope.$broadcast(APP_EVENTS.userUpdated)},this.setUserImage=function(image){this.data.image=image,localStorageService.set("currentUser",this.data)},this.activateUser=function(){this.data.email_confirmed=!0,localStorageService.set("currentUser",this.data)},this.destroy=function(){this.data=null,localStorageService.remove("currentUser",this.data)},this}])}(),function(){"use strict";angular.module("auth").controller("authCtrl",["$scope","$rootScope","$auth","$stateParams","$state","Auth","Account","State","User","Metrics","appProvider","localStorageService","jwtHelper","APP_EVENTS","USERNAME_REGEX",function($scope,$rootScope,$auth,$stateParams,$state,Auth,Account,State,User,Metrics,appProvider,localStorageService,jwtHelper,APP_EVENTS,USERNAME_REGEX){$scope.badCombo=!1,$scope.invalidEmail=!1,$scope.usernameRegex=USERNAME_REGEX,$scope.usernameAvailable=null,$scope.usernameSearch=!1,$scope.credentials={username:null,email:null},$scope.submitted=!1,$scope.processing={main:!1,fb:!1},$scope.resetEmailSent=!1,$scope.resetSuccessful=!1,$scope.loginConnect=!1,$scope.socialError=!1,$scope.user=User.data,$scope.getUserFromToken=function(res,skipSetUser){var user=jwtHelper.decodeToken(res.token);return $auth.setToken(res.token),skipSetUser||User.setUser(user),user},$scope.facebookAuth=function(){$scope.processing.fb=!0,$auth.link("facebook").then(function(res){Auth.facebookAuth(res.access_token).then(function(res){var user=$scope.getUserFromToken(res);user.new_register?$scope.registerComplete(user,"Facebook"):$scope.userLoggedIn(user,"Facebook")},function(err){$scope.socialError=!0,$scope.processing.fb=!1})},function(err){$scope.socialError=!0,$scope.processing.fb=!1})},$scope.register=function(data){$scope.processing.main=!0,Auth.register(data).then(function(res){var user=$scope.getUserFromToken(res.data);$scope.registerComplete(user,"Email")},function(err){$scope.processing.main=!1,$scope.submitted=!1;var alert="user_exists"==err.message?"accountAlreadyExists":"somethingWentWrong";$rootScope.$broadcast(APP_EVENTS.alert,alert)})},$scope.registerComplete=function(user,regType){Metrics.userRegistered(regType),amplitude.getInstance().setUserId(user.id);var identify=(new amplitude.Identify).set("Username",user.username).set("Email",user.email).set("Vlips Created",0);amplitude.identify(identify),"Email"===regType?$scope.redirectAfterRegistration():$state.go("auth.username",null,{reload:!0})},$scope.redirectAfterRegistration=function(){$rootScope.$broadcast(APP_EVENTS.alert,"verifyAccountSend"),$state.go("app.home",null,{reload:!0})},$scope.login=function(credentials){$scope.processing.main=!0,$auth.login(credentials).then(function(res){var user=$scope.getUserFromToken(res.data);$scope.userLoggedIn(user,"Email")},function(res){$scope.processing.main=!1,$scope.badCombo=!0})},$scope.userLoggedIn=function(user,loginType){Metrics.userLoggedIn(loginType),User.setUser(user),amplitude.getInstance().setUserId(user.id);var identify=(new amplitude.Identify).set("Username",user.username).set("Email",user.email);user.display_name&&identify.set("Display Name",user.display_name),user.vlip_count&&identify.set("Vlips Created",user.vlip_count),user.producer&&identify.set("Producer",!0),user.wkwii&&identify.set("Vlipsy Team",!0),amplitude.identify(identify),State.state?($state.transitionTo(State.state.name,State.state.params),State.destroy()):$state.go("app.home")},$scope.forgotPassword=function(credentials){$scope.processing.main=!0,Auth.forgotPassword(credentials).then(function(){$scope.resetEmailSent=!0,$scope.processing.main=!1},function(err){$scope.invalidEmail=!0,$scope.processing.main=!1})},$scope.resetPassword=function(credentials){credentials.resetToken=$stateParams.key,$scope.processing.main=!0,Auth.resetPassword(credentials).then(function(){$scope.resetSuccessful=!0,$scope.processing.main=!1},function(err){$scope.resetFail=!0,$scope.processing.main=!1})},$scope.checkUsername=function(username,formName){void 0!==username&&($scope.usernameAvailable=!1,$scope.usernameSearch=!0,Account.checkUsername(username).then(function(res){$scope.usernameSearch=!1,$scope.usernameAvailable=res,$scope[formName].username.$setValidity("username",res)},function(err){}))},$scope.saveUsername=function(username){return $scope.processing.main=!0,Account.updateSettings({username:username}).then(function(res){var identify=(new amplitude.Identify).set("Username",username);amplitude.identify(identify),$scope.redirectAfterRegistration()},function(err){$scope.processing.main=!1})}}])}(),function(){"use strict";angular.module("auth").directive("passwordVerify",[function(){return{restrict:"A",require:"?ngModel",link:function(scope,elem,attrs,ngModel){if(ngModel){scope.$watch(attrs.ngModel,function(){validate()}),attrs.$observe("passwordVerify",function(val){validate()});var validate=function(){var val1=ngModel.$viewValue,val2=attrs.passwordVerify;ngModel.$setValidity("passwordVerify",val1===val2)}}}}}])}(),function(){"use strict";angular.module("vlipsyApp").factory("Auth",["$location","$http","$q","$auth","User","API","localStorageService",function($location,$http,$q,$auth,User,API,localStorageService){return $auth.getToken()&&localStorageService.get("currentUser")&&(User.init(),User.setUser(localStorageService.get("currentUser"))),{register:function(credentials){var deferred=$q.defer();return $http.post(API.url+"/user?key="+API.key,credentials).then(function(data){deferred.resolve(data)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},logout:function(){$auth.logout(),User.destroy(),localStorageService.clearAll()},getCurrentUser:function(){return User.data},isLoggedInAsync:function(cb){cb(User.data&&User.data.hasOwnProperty("_id")?!0:this.isAuthenticated())},isAuthenticated:function(){return!!$auth.isAuthenticated()||(User.destroy(),!1)},isAuthorized:function(authorizedRoles){return angular.isArray(authorizedRoles)||(authorizedRoles=[authorizedRoles]),-1!==authorizedRoles.indexOf(User.data.role)},changePassword:function(credentials){var deferred=$q.defer();return $http.post(API.url+"/auth/change?key="+API.key,credentials).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},forgotPassword:function(data){var deferred=$q.defer();return $http.post(API.url+"/auth/forgot?key="+API.key,{username:data.email}).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},resetPassword:function(resetData){var deferred=$q.defer();return $http.post(API.url+"/auth/reset?key="+API.key,{token:resetData.resetToken,password:resetData.pw}).then(function(res){deferred.resolve(res)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},facebookAuth:function(access_token){var deferred=$q.defer();return $http.post(API.url+"/auth/facebook?key="+API.key,{access_token:access_token}).then(function(res){deferred.resolve(res.data)},function(err){deferred.reject(err)}.bind(this)),deferred.promise}}}])}(),function(){"use strict";angular.module("vlipsyApp").service("State",["$rootScope",function($rootScope){return this.back=!1,this.tracking=null,this.set=function(toState,toParams){this.state={},this.state.name=toState.name,this.state.params=toParams},this.setPrevious=function(fromState,fromParams){if(this.back)return void(this.back=!1);this.previous||(this.previous=[]);var obj={name:fromState.name,params:fromParams};this.previous.push(obj)},this.getPrevious=function(){return this.back=!0,this.previous[this.previous.length-1]},this.removePrevious=function(){this.previous.pop()},this.setTrackingData=function(obj){this.tracking={position:obj.position,mode:obj.mode}},this.getTrackingData=function(){return this.tracking},this.destroy=function(){this.tracking=null,this.state=null,this.previous=null},this}])}();var commentsModule=angular.module("comments",[]);!function(){"use strict";angular.module("comments").controller("commentsCtrl",["$scope","$rootScope","User","Vlips","APP_EVENTS",function($scope,$rootScope,User,Vlips,APP_EVENTS){$scope.user=User.data,$scope.comment={txt:null},$scope.comments=$scope.vlip.comments,$scope.showReply=User.data&&"artist"==User.data.role,$scope.replyFocus=!1,$scope.checkFormEmpty=function(txt){$scope.replyFocus=txt&&""!=txt},$scope.clearReply=function(){$scope.replyFocus=!1,$scope.comment.txt=null},$scope.postReply=function(reply){var obj={};obj.comment=reply.txt,obj.user=User.data,obj.id=$scope.vlip.id,Stickers.postComment(obj).then(function(res){$scope.comment.txt=null,Array.isArray($scope.comments)?$scope.comments.push(res):$scope.comments=[res]},function(err){$rootScope.$broadcast(APP_EVENTS.alert,"somethingWentWrong")})}}])}(),function(){"use strict";angular.module("comments").directive("comments",function(){return{restrict:"AE",scope:{vlip:"="},controller:"commentsCtrl",templateUrl:"common/comments/views/comments.html"}}),angular.module("comments").directive("commentItem",function(){return{restrict:"E",replace:!0,scope:{item:"="},templateUrl:"common/comments/views/commentItem.html"}})}(),function(){"use strict";angular.module("vlipsyApp").directive("btnSpinner",function(){return{link:function(scope,element,attrs){for(var btns=element[0].getElementsByTagName("button"),i=0;i<btns.length;i++){var btnLabel=btns[i].innerHTML;btns[i].innerHTML="<label>"+btnLabel+'</label><span class="spinner"><i class="far fa-spinner-third fa-spin"></i></span>'}}}})}(),function(){"use strict";angular.module("vlipsyApp").directive("compile",["$compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.compile)},function(value){element.html(value),$compile(element.contents())(scope)})}}])}(),function(){"use strict";angular.module("results").directive("elementResize",[function(){return{scope:{elementResize:"&"},link:function(scope,element,attrs){var target=element[0];scope.$watch(function(){return target.offsetHeight},function(newValue,oldValue){newValue<oldValue&&scope.elementResize()})}}}])}(),function(){"use strict";angular.module("vlipsyApp").directive("errSrc",function(){return{link:function(scope,element,attrs){element.bind("error",function(){attrs.src!=attrs.errSrc&&attrs.$set("src",attrs.errSrc)})}}})}(),function(){"use strict";angular.module("vlipsyApp").directive("explodeEffect",["User",function(User){return{restrict:"A",link:function(scope,element,attrs){function addParticles(){if(User.data)for(var width=element[0].offsetWidth,height=element[0].offsetHeight,count=0,localX=0;localX<width;localX++)for(var localY=0;localY<height;localY++){if(count%reductionFactor==0){var bcr=element[0].getBoundingClientRect(),globalX=bcr.left+localX,globalY=bcr.top+localY;createParticleAtPoint(globalX,globalY)}count++}}function createParticleAtPoint(x,y){var particle=new ExplodingParticle;particle.startX=x,particle.startY=y,particle.startTime=Date.now(),particles.push(particle)}function createParticleCanvas(){void 0===particleCanvas&&(particleCanvas=document.createElement("canvas"),particleCtx=particleCanvas.getContext("2d"),particleCanvas.width=window.innerWidth,particleCanvas.height=window.innerHeight,particleCanvas.style.position="absolute",particleCanvas.style.top="0",particleCanvas.style.left="0",particleCanvas.style.zIndex="5001",particleCanvas.style.pointerEvents="none",document.body.appendChild(particleCanvas))}function update(){void 0!==particleCtx&&particleCtx.clearRect(0,0,window.innerWidth,window.innerHeight);for(var i=0;i<particles.length;i++)if(particles[i].draw(particleCtx),i===particles.length-1){var percent=(Date.now()-particles[i].startTime)/particles[i].animationDuration;percent>1&&(particles=[])}window.requestAnimationFrame(update)}var particleCanvas,particleCtx,reductionFactor=32,color=(document.createElement("canvas"),"#DF196E"),ExplodingParticle=function(){this.animationDuration=450,this.speed={x:10*Math.random()-5,y:10*Math.random()-5},this.radius=1+5*Math.random(),this.life=30+10*Math.random(),this.remainingLife=this.life,this.draw=function(ctx){var p=this;this.remainingLife>0&&this.radius>0&&(ctx.beginPath(),ctx.arc(p.startX,p.startY,p.radius,0,2*Math.PI),ctx.fillStyle=color,ctx.fill(),p.remainingLife--,p.radius-=.25,p.startX+=p.speed.x,p.startY+=p.speed.y)}},particles=[];window.requestAnimationFrame(update),element.on("mouseover",createParticleCanvas),element.on("click",addParticles)}}}])}(),function(){"use strict";angular.module("vlipsyApp").directive("focusMe",["$parse","$timeout",function($parse,$timeout){return{link:function(scope,element,attrs){var model=$parse(attrs.focusMe);scope.$watch(model,function(value){!0===value&&$timeout(function(){element[0].focus(),attrs.focusMeSelect&&element[0].select()},500)}),element.bind("blur",function(){scope.$apply(model.assign(scope,!1))})}}}])}(),function(){"use strict";angular.module("vlipsyApp").directive("googleAd",["$timeout",function($timeout){return{restrict:"A",scope:{adSlot:"@",banner:"="},link:function(scope,element,attr){return $timeout(function(){var html,rand,size;return rand=Math.random(),size=scope.banner?"banner":"",html="<ins class='adsbygoogle "+size+"' data-ad-client='ca-pub-3687846066773928' data-ad-slot='"+scope.adSlot+"' data-ad-region='page-"+rand+"'></ins>",$(element).append(html),(window.adsbygoogle||[]).push({})})}}}])}(),function(){"use strict";angular.module("imgCrop",[]).directive("imgCropped",["$timeout",function($timeout){return{restrict:"E",replace:!0,scope:{src:"=",min:"=",selected:"&"},link:function(scope,element){var myImg,ratio,minSize,initPos,clear=function(){myImg&&(myImg.next().remove(),myImg.remove(),myImg=void 0)};scope.$watch("src",function(imgSrc){if(clear(),imgSrc){var image=new Image;image.src=imgSrc,image.onload=function(){var styles=this.width>this.height?"max-width: 100%; height: auto;":"max-height: 470px; width: auto !important;";element.after('<img style="'+styles+'"/>'),myImg=element.next(),myImg.attr("src",imgSrc);var self=this;$timeout(function(){ratio=self.width/myImg.width(),minSize=Math.ceil(scope.min/ratio);var maxedSize=self.width<self.height?myImg.width()/2:myImg.height()/2;initPos={x1:myImg.width()/2-maxedSize,x2:myImg.width()/2+maxedSize,y1:myImg.height()/2-maxedSize,y2:myImg.height()/2+maxedSize},$(myImg).Jcrop({trackDocument:!0,onSelect:function(cords){var cropObj={x:Math.round(cords.x*ratio),y:Math.round(cords.y*ratio),h:Math.round(cords.h*ratio),w:Math.round(cords.w*ratio)};scope.$parent.selected(cropObj)},aspectRatio:1,boxWidth:570,boxHeight:470,minSize:[minSize,minSize],setSelect:[initPos.x1,initPos.y1,initPos.x2,initPos.y2]})})}}}),scope.$on("$destroy",clear)}}}])}(),function(){"use strict";angular.module("vlipsyApp").directive("jsonld",["$filter","$sce",function($filter,$sce){return{restrict:"E",template:function(){return'<script type="application/ld+json" ng-bind-html="onGetJson()"><\/script>'},scope:{json:"=json"},link:function(scope,element,attrs){scope.$watch("json",scope.onGetJson),scope.onGetJson=function(){return $sce.trustAsHtml($filter("json")(scope.json))}},replace:!0}}])}(),function(){"use strict";angular.module("vlipsyApp").directive("ngLoading",["$compile",function($compile){return{restrict:"A",link:function(scope,element,attrs){var loadingSpinner=(element.html(),$('<div class="loader"><i class="far fa-spinner-third fa-spin"></i></div>'));scope.$watch(attrs.ngLoading,function(val){val?loadingSpinner.remove():element.append(loadingSpinner)})}}}])}(),function(){"use strict";angular.module("vlipsyApp").directive("ngMuted",function(){return{link:function(scope,element,attrs){attrs.$observe("ngMuted",function(value){element[0].muted="false"!=value})}}})}(),function(){"use strict";angular.module("vlipsyApp").directive("ngThumb",["$window","$rootScope","APP_EVENTS",function($window,$rootScope,APP_EVENTS){var params,canvas,_scope,helper={support:!(!$window.FileReader||!$window.CanvasRenderingContext2D),isFile:function(item){return angular.isObject(item)&&item instanceof $window.File},isImage:function(file){return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf("|"+file.type.slice(file.type.lastIndexOf("/")+1)+"|")}},onLoadFile=function(event){var img=new Image;img.onload=onLoadImage,img.src=event.target.result},onLoadImage=function(){var width=params.width||Math.round(this.width/this.height*params.height),height=params.height||Math.round(this.height/this.width*params.width),x=params.x||0,y=params.y||0,sizeW=params.size&&params.size.width||width,sizeH=params.size&&params.size.height||height;canvas.attr({width:sizeW,height:sizeH}),params.size?canvas[0].getContext("2d").drawImage(this,x,y,width,height,0,0,sizeW,sizeH):canvas[0].getContext("2d").drawImage(this,x,y,width,height)};return{restrict:"E",template:"<canvas/>",scope:{errorCheck:"&",reload:"=reload",settings:"="},link:function(scope,element,attributes){helper.support&&(_scope=scope,scope.$watch("reload",function(val){if(!0===scope.reload){if(params=scope.settings,canvas=element.find("canvas"),!params.cropped){if(!helper.isFile(params.file))return;if(!helper.isImage(params.file))return}var reader=new FileReader;reader.onload=onLoadFile,reader.readAsDataURL(params.file)}}))}}}])}(),function(){"use strict";angular.module("vlipsyApp").directive("onFinishRender",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attr){!0===scope.$last&&$timeout(function(){scope.$emit(attr.onFinishRender)})}}}])}(),function(){"use strict";angular.module("vlipsyApp").directive("preloader",function(){return{restrict:"AE",replace:!0,template:'<svg class="preloader" viewBox="25 25 50 50"><circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></svg>'}})}(),function(){"use strict";var selectAllOnClick=function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("click",function(){element[0].select()})}}};angular.module("vlipsyApp").directive("selectAllOnClick",selectAllOnClick)}(),function(){"use strict";angular.module("vlipsyApp").filter("hyphenate",function(){return function(txt){return txt.toLowerCase().replace(/\s+/,"-")}}),angular.module("vlipsyApp").filter("unhyphenate",function(){return function(txt){return txt.replace(/-/g," ")}}),angular.module("vlipsyApp").filter("capitalize",function(){return function(input,all){return input?input.replace(/([^\W_]+[^\s-]*) */g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()}):""}}),angular.module("vlipsyApp").filter("hasProperty",function(){return function(obj,key){return obj.hasOwnProperty(key)}}),angular.module("vlipsyApp").filter("pluralize",function(){return function(value){return null==value||"string"==typeof value?"s":Array.isArray(value)?value.length>1||0==value.length?"s":"":value>1||0==value?"s":""}}),angular.module("vlipsyApp").filter("flattenSearchTerm",function(){return function(term){var _term=term.replace(/(_)/,"-");return _term=_term.replace(/(-)/g," "),_term=_term.replace(/[^a-zA-Z0-9 ]/g,""),_term=_term.toLowerCase()}}),angular.module("vlipsyApp").filter("arrayToCommaSeparatedString",function(){return function(arr,condense){for(var flat="",comma=condense?",":", ",i=0;i<arr.length;i++)flat+=arr[i],i!=arr.length-1&&(flat+=comma);return flat}}),angular.module("vlipsyApp").filter("arrayToString",function(){return function(arr){for(var flat="",i=0;i<arr.length;i++)flat+=arr[i],i!=arr.length-1&&(flat+=" ");return flat}}),angular.module("vlipsyApp").filter("convertToURL",function(){return function(input){if(input)return input.toLowerCase().replace(/s+/g,"-").replace(/[^a-z0-9-]/gi,"")}}),angular.module("vlipsyApp").filter("isNotObject",function(){return function(val){return!_.isObject(val)}}),angular.module("vlipsyApp").filter("timeToSchema",function(){return function(val){return"PT"+Math.round(val)+"S"}}),angular.module("vlipsyApp").filter("formatTimeDisplay",function(){return function(val){var sec=Math.round(val);return sec<10&&(sec="0"+sec),"00:"+sec}}),angular.module("vlipsyApp").filter("shortNumber",function(){return function(num){if(null==num)return null;var val=num.toString();if(val.length<4)return val;var str=val.substring(0,1)+"."+val.substring(1,2);return val.length<7?str+"K":val.length<10?str+"M":str+"B"}}),angular.module("vlipsyApp").filter("stripHttp",function(){return function(url){return url.replace(/^https?\:\/\//i,"")}})}(),function(){"use strict";angular.module("meme").controller("memeToolCtrl",["$scope","$sce","$uibModal","$uibModalInstance","User","Memes","Metrics","APP_EVENTS","CDN_URL","vlip",function($scope,$sce,$uibModal,$uibModalInstance,User,Memes,Metrics,APP_EVENTS,CDN_URL,vlip){$scope.vlip=vlip,$scope.meme={credit:!1,top:"",bottom:"",mode:"both"},$scope.focus={top:!1,bottom:!1},$scope.username=User.data?User.data.username:null,$scope.limit={top:!1,bottom:!1},$scope.save=!1,$scope.cdnURL=CDN_URL.secure,$scope.embedHtml=$sce.trustAsHtml('<iframe src="/embed/'+vlip.id+'?sharing=0"></iframe>'),$scope.$on(APP_EVENTS.memeReady,function(event,image){event.preventDefault(),User.data&&($scope.meme.creator=User.data),$scope.meme.image=image,$scope.meme.vlip=vlip.id,Memes.create($scope.meme).then(function(res){},function(err){})}),$scope.close=function(){$uibModalInstance.dismiss()}}])}(),function(){"use strict";angular.module("meme").directive("captureCanvas",["APP_EVENTS",function(APP_EVENTS){return{restrict:"A",scope:{save:"=captureCanvas"},link:function(scope,elem,attrs){var player=elem.find(".vlip-player")[0],meme=elem[0];scope.$watch("save",function(){scope.save&&setTimeout(function(){player.display="none";var options={scale:"1.125"};html2canvas(meme,options).then(function(canvas){scope.$emit(APP_EVENTS.memeReady,canvas.toDataURL("images/jpeg",1))}),player.display="block"},50)})}}}])}(),function(){"use strict";angular.module("meme").directive("textAutoSize",["APP_EVENTS",function(APP_EVENTS){return{restrict:"A",scope:{mode:"=textAutoSize",text:"=watchMe"},link:function(scope,element,attrs){function setFontSize(small){scope.$apply(function(){small?angular.element(element).addClass("size-lg"):element[0].removeClass("size-lg"),scaled=small,newLineLimit=small?prevValue.length:null})}function setMaxLimit(bool){scope.$apply(function(){bool?element.parent().addClass("limit"):element.parent().removeClass("limit"),limit=bool,maxLimit=prevValue.length})}var input=element[0].parentElement.querySelector("input"),maxHeight="both"==scope.mode?96:216,prevHeight=element[0].clientHeight,prevValue="",newLineLimit=null,maxLimit=null,scaled=!1,limit=!1;angular.element(input).bind("keydown",_.debounce(function(event){var height=element[0].clientHeight;scope.text;if(height>=prevHeight&&height>=maxHeight){if(scaled)return setMaxLimit(!0),void(scope.text=prevValue);prevHeight=height,setFontSize(!0)}else maxLimit&&scope.text.length<maxLimit?setMaxLimit(!1):scaled&&scope.text.length<=newLineLimit&&(setFontSize(!1),newLineLimit=null,limit=!1);height<prevHeight&&(prevHeight=height),prevValue=scope.text},100))}}}])}(),function(){"use strict";angular.module("meme").factory("Memes",["$http","$q","Metrics","API","PER_PAGE_LIMIT",function($http,$q,Metrics,API,PER_PAGE_LIMIT){var _apiURL=API.url+"/v"+API.version;return{get:function(page){var deferred=$q.defer(),offset=page||0,url=_apiURL+"/memes?limit="+PER_PAGE_LIMIT+"&offset="+offset+"&api_key="+API.key;return $http.get(url,{skipAuthorization:!0}).success(function(res){deferred.resolve(res)}).error(function(err){deferred.reject(err)}.bind(this)),deferred.promise},create:function(config){var deferred=$q.defer();return $http.post("http://memes.vlipsy:8504/memes",config).success(function(res){deferred.resolve(res)}).error(function(err){deferred.reject(err)}.bind(this)),deferred.promise}}}])}(),function(){"use strict";angular.module("meta").controller("embedCtrl",["$scope","$sce","vlip",function($scope,$sce,vlip){$scope.vlip=vlip,$scope.src=$sce.trustAsResourceUrl(vlip.vlip_url)}])}(),function(){"use strict";angular.module("meta").controller("metaCtrl",["$scope","$window","appProvider","MetaData",function($scope,$window,appProvider,MetaData){$scope.meta=null,$scope.isMobileBrowser=appProvider.isMobileBrowser,$scope.secure="https:"==window.location.protocol,$scope.$on("meta-updated",function(event){$scope.meta=MetaData.getPageMetaData()})}])}(),function(){"use strict";angular.module("meta").service("MetaData",["$rootScope","$window","$filter","SERVICE_URL","META","APP_EVENTS",function($rootScope,$window,$filter,SERVICE_URL,META,APP_EVENTS){return this.setData=function(page){this.data||(this.data={}),this.data.title=page.data&&page.data.title?page.data.title:META.title,this.data.description=page.data&&page.data.description?page.data.description:META.description,this.data.keywords=page.data&&page.data.keywords?page.data.keywords:META.keywords,this.data.structured=null,page.name.indexOf("app.home")>-1&&(this.data.structured={"@context":"http://schema.org","@type":"WebSite",url:"https://vlipsy.com/",potentialAction:{"@type":"SearchAction",target:"https://vlipsy.com/search/{search_term_string}","query-input":"required name=search_term_string"}}),this.data.image={},this.data.image.url="https://assets.vlipsy.com/images/vlipsy-social-image.jpg",$rootScope.$broadcast(APP_EVENTS.metaUpdated)},this.setURL=function(){this.data.url=document.URL},this.setFromVlip=function(vlip,hideDescription){this.data||(this.data={}),this.data.title=vlip.from?vlip.from+": ":"",this.data.title+=vlip.title,this.data.description=hideDescription?"":"Watch & share this "+vlip.from+" video clip in your texts, tweets and comments. Find and share the best video clips and quotes on Vlipsy.",this.data.url="https://"+window.location.hostname+"/vlip/"+vlip.slug,this.data.image={},this.data.image.url=vlip.media.preview?vlip.media.preview.url:"",this.data.type="video",this.data.video={},this.data.video.url=vlip.media.mp4.url,this.data.video.secure_url=vlip.media.mp4.url,this.data.video.tags=vlip.tags,this.data.embed="https://"+window.location.hostname+"/embed/"+vlip.id,this.data.oembed="https://"+window.location.hostname+"/oembed?url="+encodeURIComponent(this.data.url),this.data.twitter={},this.data.twitter.type="player",this.data.facebook={},this.data.facebook.type="facebook",this.data.keywords=$filter("arrayToCommaSeparatedString")(vlip.tags,!0);var desc=vlip.from?vlip.from+" - ":"",thumbPath=vlip.media.preview_small?vlip.media.preview_small.url:"";this.data.structured={"@context":"http://schema.org","@type":"Article",author:vlip.creator.username,dateModified:vlip.created,datePublished:vlip.created,headline:this.data.title,mainEntityOfPage:{"@type":"WebPage","@id":this.data.url},publisher:{"@context":"http://schema.org","@type":"Organization",name:"Vlipsy",logo:{"@type":"ImageObject",url:"https://assets.vlipsy.com/logos/vlipsy-logo.png"},sameAs:["https://www.facebook.com/vlipsy","https://www.instagram.com/vlipsy","https://twitter.com/vlipsyApp","https://www.linkedin.com/company/vlipsy"]},image:{"@type":"ImageObject",author:vlip.creator.username,contentUrl:this.data.image.url,creator:vlip.creator.username,description:desc+this.data.description,embedUrl:this.data.embed,height:390,keywords:this.data.keywords,name:this.data.title,representativeOfPage:!0,thumbnailUrl:thumbPath,uploadDate:vlip.created,url:this.data.url,width:694},video:{"@type":"videoObject",author:vlip.creator.username,contentUrl:vlip.vlip_url,creator:vlip.creator.username,description:desc+this.data.description,embedUrl:this.data.embed,height:360,keywords:this.data.keywords,name:this.data.title,thumbnailUrl:thumbPath,uploadDate:vlip.created,url:this.data.url,width:640}},$rootScope.$broadcast(APP_EVENTS.metaUpdated)},this.setFromArticle=function(article){this.data||(this.data={}),this.data.structured={"@context":"http://schema.org","@type":"WebSite",url:"https://vlipsy.com/",potentialAction:{"@type":"SearchAction",target:"https://vlipsy.com/search/{search_term_string}","query-input":"required name=search_term_string"}},this.data.title=article.title,this.data.description=META.description,this.data.url=SERVICE_URL+"/article/"+article.slug,
this.data.image={url:article.image},$rootScope.$broadcast(APP_EVENTS.metaUpdated)},this.setFromProfile=function(user){this.data||(this.data={});var name=user.display_name||user.username;this.data.title=name+" Video Clips - Find & Share on Vlipsy",this.data.description=META.description,this.data.url=SERVICE_URL+"/u/"+user.username,this.data.image={url:user.avatar,width:300,height:300},this.data.structured={"@context":"http://schema.org","@type":"Person",name:user.display_name||user.username,image:user.avatar,url:this.data.url},$rootScope.$broadcast(APP_EVENTS.metaUpdated)},this.setFromSearch=function(term,data){var _term=this.toTitleCase(term);this.data.title=_term+" Video Clips - Find & Share on Vlipsy",this.data.description=META.description,this.data.url=SERVICE_URL+"/search/"+term;var list=this.formatVlipList(data);this.data.structured=[{"@context":"http://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,item:{"@id":"https://www.vlipsy.com",name:"Home"}}]},{"@context":"http://schema.org","@type":"ItemList",itemListElement:list}],$rootScope.$broadcast(APP_EVENTS.metaUpdated)},this.setFromPlaylist=function(playlist,slug,data){var _term=this.toTitleCase(playlist.title);this.data.title=_term+" Playlist on Vlipsy - Find & Share Video Clips",this.data.description="A collection of the best "+_term+" video clips found on the internet.",this.data.url=SERVICE_URL+"/playlist/"+slug,this.data.image={},this.data.image.url=playlist.image;var list=this.formatVlipList(data);this.data.structured=[{"@context":"http://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,item:{"@id":"https://www.vlipsy.com",name:"Home"}}]},{"@context":"http://schema.org","@type":"ItemList",itemListElement:list}],$rootScope.$broadcast(APP_EVENTS.metaUpdated)},this.setFromTrending=function(data){this.data.title="Trending Videos on Vlipsy - Search, Create and Share Video Clips",this.data.description=META.description,this.data.url=SERVICE_URL+"/trending",this.data.image={},this.data.image.url="https://assets.vlipsy.com/images/vlipsy-social-image.jpg";var list=this.formatVlipList(data);this.data.structured=[{"@context":"http://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,item:{"@id":"https://www.vlipsy.com",name:"Home"}}]},{"@context":"http://schema.org","@type":"ItemList",itemListElement:list}],$rootScope.$broadcast(APP_EVENTS.metaUpdated)},this.setFromRelated=function(data,id){this.data.title=META.title,this.data.description=META.description,this.data.url=SERVICE_URL+"/related/"+id,this.data.image={},this.data.image.url="https://assets.vlipsy.com/images/vlipsy-social-image.jpg";var list=this.formatVlipList(data);this.data.structured=[{"@context":"http://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,item:{"@id":"https://www.vlipsy.com",name:"Home"}}]},{"@context":"http://schema.org","@type":"ItemList",itemListElement:list}],$rootScope.$broadcast(APP_EVENTS.metaUpdated)},this.formatVlipList=function(data){for(var list=[],limit=data.length>10?10:data.length,i=0;i<limit;i++){var vlip=data[i],title=vlip.from?vlip.from+": "+vlip.title:vlip.title,description="A video clip titled "+vlip.title;vlip.from&&(description+=" from "+vlip.from),description+=" created on Vlipsy.com. Vlipsy is the best source for short video moments, quotes and scenes from movies, TV and viral videos.";var obj={"@type":"ListItem",position:i+1,item:{"@type":"VideoObject",contentUrl:vlip.media.mp4.watermark,description:description,duration:this.convertToDuration(vlip.duration),embedUrl:"https://"+window.location.hostname+"/embed/"+vlip.id,height:480,keywords:vlip.tags,name:title,thumbnailUrl:vlip.media.preview_small.url,uploadDate:vlip.created,url:"https://"+window.location.hostname+"/vlip/"+vlip.slug,width:854}};list.push(obj)}return list},this.toTitleCase=function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})},this.convertToDuration=function(time){return"PT"+(time<1?1:time)+"S"},this.getPageMetaData=function(){return this.data},this.getPageDescription=function(){return this.data.description},this}])}(),function(){"use strict";angular.module("vlipsyApp").factory("Metrics",["$state","State","API","appProvider",function($state,State,API,appProvider){var client="Vlipsy.com";return{userRegistered:function(type){var eventProperties={Client:client,"Registered Using":type};amplitude.getInstance().logEvent("User Registered",eventProperties)},userLoggedIn:function(type){var eventProperties={Client:client,"Registered Using":type};amplitude.getInstance().logEvent("User Logged In",eventProperties)},pageViewed:function(){var eventProperties={Client:client,"Page Name":$state.current.title};amplitude.getInstance().logEvent("Page Viewed",eventProperties)},logVlipsServed:function(count,from,term){var eventProperties={Client:client,Served:count,"Requested From":from};term&&"Playlist"==from&&(eventProperties["Playlist Name"]=term),term&&"Search"==from&&(eventProperties["Search Term"]=term),amplitude.getInstance().logEvent("Vlips Served",eventProperties)},logSearch:function(term,raw,count){var eventProperties={Client:client,"Search Term":term,"Raw Input":raw,"Result Count":count};amplitude.getInstance().logEvent("Vlips Searched",eventProperties)},logPlaylistView:function(id,title){var eventProperties={Client:client,"Playlist ID":id,"Playlist Name":title};amplitude.getInstance().logEvent("Playlist Viewed",eventProperties)},createButtonClick:function(){var eventProperties={Client:client,"Accessed From":$state.current.title};amplitude.getInstance().logEvent("Create Button Clicked",eventProperties)},vlipCreated:function(vlipID,username){var from=appProvider.isMobileBrowser?"Mobile Web":"Desktop Web",eventProperties={Client:client,"Vlip ID":vlipID,Creator:username,"Created From":from};amplitude.getInstance().logEvent("Vlip Created",eventProperties)},tagViewed:function(tag,obj){var tracking=State.getTrackingData(),eventProperties={Client:client,"Tag Name":tag,"Accessed From":obj.mode.type},type=tracking.mode.type.toLowerCase();"playlist"===type&&(eventProperties["Playlist Name"]=obj.mode.source),"search"===type&&(eventProperties["Search Term"]=obj.mode.source),"related"===type&&(eventProperties["Related Vlip"]=obj.mode.source),obj.vlip&&(eventProperties["Vlip Name"]=obj.vlip.source?obj.vlip.source+":  "+obj.vlip.title:obj.vlip.title,eventProperties["Vlip ID"]=obj.vlip.id,eventProperties["Vlip Tags"]=obj.vlip.tags,eventProperties["Vlip URL"]="https://vlipsy.com/vlip/"+obj.vlip.id,eventProperties["List Position"]=obj.position,eventProperties.Creator=obj.vlip.creator.username),amplitude.getInstance().logEvent("Tag Viewed",eventProperties)},vlipViewed:function(obj){var eventProperties=this.getStandardVlipProperties(obj);amplitude.getInstance().logEvent("Vlip Viewed",eventProperties)},vlipUnmuted:function(obj){var eventProperties=this.getStandardVlipProperties(obj);amplitude.getInstance().logEvent("Vlip Unmuted",eventProperties)},logShare:function(platform,vlip){var eventProperties=this.getStandardVlipProperties(vlip);eventProperties.Platform=platform,amplitude.getInstance().logEvent("Vlip Shared",eventProperties);var title=vlip.source?vlip.source+": "+vlip.title:vlip.title;ga("send","event","share",platform,title+" ["+vlip.id+"]")},vlipFavorited:function(obj){var eventProperties=this.getStandardVlipProperties(obj);amplitude.getInstance().logEvent("Vlip Favorited",eventProperties)},getAppClick:function(platform){var eventProperties={Platform:platform};amplitude.getInstance().logEvent("Get App Button Clicked",eventProperties)},vlipContextClick:function(obj,url){var eventProperties=this.getStandardVlipProperties(obj);eventProperties["Context URL"]=url,eventProperties["Context Button Label"]=obj.feature.button_label,amplitude.getInstance().logEvent("Vlip Context Clicked",eventProperties)},vlipSourceClick:function(obj){var eventProperties=this.getStandardVlipProperties(obj);eventProperties["Source URL"]=obj.vid_url,amplitude.getInstance().logEvent("Vlip Source Clicked",eventProperties)},vlipViewData:function(vlip,viewData){var eventProperties=this.getStandardVlipProperties(vlip);eventProperties["Muted Loop Count"]=viewData.muted.loops,eventProperties["Unmuted Loop Count"]=viewData.unmuted.loops,eventProperties["Muted Percentage Viewed"]=viewData.muted.percentage,eventProperties["Unmuted Percentage Viewed"]=viewData.unmuted.percentage,eventProperties["Muted Time Viewed"]=viewData.muted.time,eventProperties["Unmuted Time Viewed"]=viewData.unmuted.time,amplitude.getInstance().logEvent("Vlip View Data",eventProperties)},getStandardVlipProperties:function(obj){var tracking=State.getTrackingData(),eventProperties={Client:client,"Vlip Name":obj.from?obj.from+":  "+obj.title:obj.title,"Vlip ID":obj.id,"Vlip Tags":obj.tags,"Vlip URL":"https://vlipsy.com/vlip/"+obj.id,"Accessed From":"Direct Link"};if(obj.creator&&(eventProperties.Creator=obj.creator.username),tracking){eventProperties["Accessed From"]=tracking.mode.type;var type=tracking.mode.type.toLowerCase();tracking.position&&(eventProperties["List Position"]=tracking.position),"playlist"===type&&(eventProperties["Playlist Name"]=tracking.mode.source),"search"===type&&(eventProperties["Search Term"]=tracking.mode.source),"related"===type&&(eventProperties["Related Vlip"]=tracking.mode.source,eventProperties["Related Gesture"]=tracking.mode.gesture||"Tap"),"favorites"!==type&&"profile"!==type||(eventProperties.Username=tracking.mode.source)}return eventProperties}}}])}(),function(){"use strict";angular.module("profile").controller("profileCtrl",["$scope","User","DEFAULT_AVATAR","user",function($scope,User,DEFAULT_AVATAR,user){function setupSocialLinks(social){var array=[];for(var key in social){var obj={},val="@"===social[key].charAt(0)?social[key].substring(1,social[key].length):social[key];if("twitter"===key)obj.icon="fab fa-twitter",obj.link="https://twitter.com/"+val;else if("facebook"===key)obj.icon="fab fa-facebook-f",obj.link=val;else if("instagram"===key)obj.icon="fab fa-instagram",obj.link="https://instagram.com/"+val;else{if("youtube"!==key)break;obj.icon="fab fa-youtube",obj.link=val}array.push(obj)}return array}$scope.user=user,user&&($scope.isUser=User.data&&User.data.username==user.username,$scope.social=setupSocialLinks(user.social_profiles),$scope.verified=user.verified),$scope.avatar=user?user.avatar:DEFAULT_AVATAR}])}(),function(){"use strict";angular.module("profile").controller("profileVlipsCtrl",["$scope","$rootScope","$state","$sce","vlips",function($scope,$rootScope,$state,$sce,vlips){function getEmptyState(){return $scope.user?"favorites"==$scope.mode?{mode:"favorites",src:"4ZhU8Lr4"}:$scope.isUser?{mode:"no-vlips-user",src:"BJXONbzh"}:{mode:"no-vlips",src:"LXgLswap"}:{mode:"no-user",src:"9VDyLcuX"}}$scope.vlips=vlips,$scope.mode="app.user.vlips"===$state.current.name?"profile":"favorites","profile"===$scope.mode&&vlips.data.length>0&&($scope.user.vlip_count=vlips.pagination.total_count),$scope.noResults=!$scope.user||0==vlips.data.length,$scope.video={muted:!0},$scope.noResults&&($scope.emptyState=getEmptyState(),$scope.emptyState.video=$sce.trustAsResourceUrl("/embed/"+$scope.emptyState.src+"?sharing=0")),$scope.createVlip=function(){$rootScope.$broadcast(APP_EVENTS.newVlip)},$scope.toggleMute=function(){$scope.video.muted=!$scope.video.muted},$scope.goBack=function(){$window.history.back()}}])}(),function(){"use strict";angular.module("profile").directive("profileHeader",["appProvider",function(appProvider){return{restrict:"E",templateUrl:function(){return appProvider.isMobileBrowser?"profile/views/profileHeader-mobile.html":"profile/views/profileHeader.html"},scope:{user:"="},controller:["$scope",function($scope){}]}}])}(),function(){"use strict";angular.module("profile").factory("Profile",["$http","$q","$window","SERVICE_URL","PER_PAGE_LIMIT","API",function($http,$q,$window,SERVICE_URL,PER_PAGE_LIMIT,API){return{getVlips:function(username,page,limit){var deferred=$q.defer(),count=limit||PER_PAGE_LIMIT,pos=page?page*count:0,url=API.url+"/users/"+username+"/vlips?pos="+pos+"&limit="+count+"&key="+API.key;return $http.get(url).then(function(res){res.data.type="vlips",res.data.pagination.limit=count,deferred.resolve(res.data)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},getUser:function(username){var deferred=$q.defer(),url=API.url+"/users/"+username+"?key="+API.key;return $http.get(url).success(function(res){deferred.resolve(res.data)}).error(function(err){deferred.reject(err)}.bind(this)),deferred.promise}}}])}(),function(){"use strict";angular.module("results").controller("homeCtrl",["$scope","User","playlists",function($scope,User,playlists){$scope.playlists=playlists.slice(0,10),$scope.trendingTitle="Trending Vlips",$scope.user=User.data}])}(),function(){"use strict";angular.module("results").controller("homeMobileCtrl",["$scope","$rootScope","$state","$stateParams","$filter","User","Profile","Vlips","appProvider","APP_EVENTS","vlips",function($scope,$rootScope,$state,$stateParams,$filter,User,Profile,Vlips,appProvider,APP_EVENTS,vlips){function fetchPlaylists(){Vlips.getPlaylists().then(function(playlists){$scope.playlists=playlists.data,$scope.loaded.playlists=!0},function(err){$rootScope.$broadcast(APP_EVENTS.alert,"somethingWentWrong")})}function getUserVlips(){$scope.snapshot.vlips?$scope.loaded.vlips=!0:Profile.getVlips($scope.user.username,0,10).then(function(res){$scope.noVlips=0==res.pagination.total_count,$scope.snapshot.vlips=res,$scope.loaded.vlips=!0},function(err){$scope.loaded.vlips=!0})}function getUserFavorites(){$scope.snapshot.favorites?$scope.loaded.favorites=!0:Vlips.getFavorites(0,10).then(function(res){$scope.noFavs=0==res.pagination.total_count,$scope.snapshot.favorites=res,$scope.loaded.favorites=!0},function(err){$scope.loaded.favorites=!0})}$scope.vlips=vlips,$scope.trendingTitle="Trending Vlips",$scope.homeTab={state:"trending"},$scope.loaded={vlips:!1,favorites:!1,playlists:!1},$scope.user=User.data,$scope.snapshot={vlips:null,favorites:null};var userAgent=navigator.userAgent||navigator.vendor||window.opera;$scope.iPhone=/iPhone|iPod/.test(userAgent)&&!window.MSStream,$scope.user&&($scope.noVlips=$scope.snapshot.vlips&&0==$scope.snapshot.vlips.data.length,$scope.noFavs=$scope.snapshot.favorites&&0==$scope.snapshot.favorites.data.length),$scope.switchMobileTab=function(tab){$scope.homeTab.state=tab,"playlists"!=tab||$scope.playlists||fetchPlaylists(),"user"==tab&&(getUserVlips(),getUserFavorites()),$state.go("app.home",{tab:tab},{notify:!1})},$scope.loadPlaylist=function(slug){$state.go("app.playlist",{slug:slug})},appProvider.isMobileBrowser&&$scope.user&&$scope.switchMobileTab($stateParams.tab)}])}(),function(){"use strict";angular.module("results").controller("resultsCtrl",["$scope","$state","$stateParams","User","appProvider",function($scope,$state,$stateParams,User,appProvider){$scope.noResults=0==$scope.vlips.data.length,$scope.pageVars=angular.copy($scope.vlips.pagination),$scope.pageVars.max=appProvider.isMobileBrowser?4:8,$scope.pageVars.limit=$scope.vlips.pagination.limit,$scope.pageVars.currentPage=Math.round($scope.vlips.pagination.offset/$scope.pageVars.limit)+1,$scope.numPages=Math.ceil($scope.vlips.pagination.total_count/$scope.pageVars.limit),$scope.loaded=!1,$scope.pageChanged=function(){if("app.playlist"===$state.current.name)return void $state.go("app.playlist",{page:$scope.pageVars.currentPage});if("browse"===$scope.type)$state.go("app.home",{page:$scope.pageVars.currentPage});else if("profile"===$scope.type){var _username=$scope.user?$scope.user.username:User.data.username;$state.go("app.user.vlips",{username:_username,page:$scope.pageVars.currentPage})}else if("favorites"===$scope.type){var _username=$scope.user?$scope.user.username:User.data.username;$state.go("app.user.favorites",{username:_username,page:$scope.pageVars.currentPage})}else"trending"===$scope.type?$state.go("app.trending",{page:$scope.pageVars.currentPage}):$state.go("app.search-page",{term:$stateParams.term,page:$scope.pageVars.currentPage})},$scope.video={muted:!0},$scope.toggleMute=function(){$scope.video.muted=!$scope.video.muted},$scope.$on("ngRepeatFinished",function(event){event.stopPropagation(),$scope.loaded=!0})}])}(),function(){"use strict";angular.module("results").controller("theaterModalCtrl",["$scope","$uibModalInstance","config",function($scope,$uibModalInstance,config){$scope.config=config,$scope.vidNum=0,$scope.close=function(){$uibModalInstance.dismiss()}}])}(),function(){"use strict";angular.module("results").controller("vlipThumbCtrl",["$scope","$sce","$window","$filter","$timeout","Vlips","Metrics","SOCIAL_APPS",function($scope,$sce,$window,$filter,$timeout,Vlips,Metrics,SOCIAL_APPS){$scope.embedHtml=$sce.trustAsHtml('<iframe src="/embed/'+$scope.config.id+'?sharing=0"></iframe>'),$scope.title=$scope.config.from?$scope.config.from+": "+$scope.config.title:$scope.config.title,$scope.copyLink="https://vlp.to/"+$scope.config.id,$scope.copied=!1,$scope.copyLinkToClipboard=function(event){Metrics.logShare("Link",$scope.config),ga("send","event","share","copy-link",$scope.title+"["+$scope.config.id+"]"),$scope.copied=!0,$timeout(function(){$scope.copied=!1},3e3)},$scope.clipError=function(event){},$scope.download=function(){Metrics.logShare("Download",$scope.config),ga("send","event","download",$scope.title+" ["+$scope.config.id+"]"),Vlips.download($scope.config.id)},$scope.facebookShare=function(){Metrics.logShare("Facebook",$scope.config);var url="http://www.facebook.com/sharer/sharer.php?u="+$scope.copyLink;return $window.open(url,SOCIAL_APPS.facebook,"width=650,height=335,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0"),!1},$scope.twitterShare=function(){Metrics.logShare("Twitter",$scope.config);var url="http://twitter.com/share?url="+$scope.copyLink+"&via=VlipsyApp";return $window.open(url,SOCIAL_APPS.twitter,"width=650,height=260,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0"),!1},$scope.pinterestShare=function(){Metrics.logShare("Pinterest",$scope.config);var url="http://www.pinterest.com/pin/create/button/?url="+$scope.copyLink+"&media="+$scope.config.media.preview.url+"&is_video=true&description="+$scope.title+" - Vlipsy.com";return $window.open(url,SOCIAL_APPS.pinterest,"width=750,height=550,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0"),!1},$scope.tumblrShare=function(){Metrics.logShare("Tumblr",$scope.config);var tags=$filter("arrayToCommaSeparatedString",$scope.config.tags),params="canonicalUrl="+encodeURIComponent($scope.copyLink)+"&content="+encodeURIComponent("https://"+window.location.hostname+"/embed/"+$scope.config.id)+"&caption="+encodeURIComponent('(via <a href="'+$scope.copyLink+'">Vlipsy</a>)')+"&clickthroughUrl="+encodeURIComponent($scope.copyLink)+"&posttype=video&tags=vlipsy"+encodeURIComponent(","+tags);return $window.open("http://www.tumblr.com/widgets/share/tool?"+params,"","width=750,height=650,toolbar=0,menubar=0,location=0,status=0,scrollbars=1,resizable=1,left=0,top=0"),!1},$scope.redditShare=function(){Metrics.logShare("Reddit",$scope.config);var url="http://www.reddit.com/submit?url="+$scope.copyLink+"&title="+$scope.title+" - Vlipsy.com";return $window.open(url,"","width=750,height=650,toolbar=0,menubar=0,location=0,status=0,scrollbars=1,resizable=1,left=0,top=0"),!1},$scope.messengerShare=function(){Metrics.logShare("Messenger",$scope.config);var url="http://www.facebook.com/dialog/send?app_id="+SOCIAL_APPS.facebook+"&link="+$scope.copyLink+"&redirect_uri="+$scope.copyLink;return $window.open(url,SOCIAL_APPS.facebook),!1}}])}(),function(){"use strict";angular.module("results").directive("collectionRow",["$rootScope","Vlips","APP_EVENTS",function($rootScope,Vlips,APP_EVENTS){return{restrict:"E",replace:!0,templateUrl:"results/views/collectionRow.html",scope:{rowTitle:"=",related:"=",relatedSrc:"=",mode:"=",playlist:"="},link:function(scope,elem,attrs){function getData(){("trending"==scope.mode?Vlips.get("low",0,40):Vlips.getPlaylistVlips(scope.playlist,0,40)).then(function(res){data=res.data,res&&init()},function(res){})}function updateView(){var rightDisabled=!data||page+1==Math.ceil(data.length/itemCount),leftDisabled=0==page;$rightArrow.attr("disabled",rightDisabled),$leftArrow.attr("disabled",leftDisabled);var offset=page*itemCount;scope.list=data.slice(offset,offset+itemCount)}function slidePage(direction){var pct="next"==direction?"-100%":"0%",offset="next"==direction?(page-1)*itemCount:page*itemCount;scope.list=data.slice(offset,offset+2*itemCount),$slider.parent().css("overflow","hidden"),"previous"==direction&&$slider.css("transform","translateX(-100%)"),setTimeout(function(){$slider.addClass("slider-contents--animating"),$slider.css("transform","translateX("+pct+")")},0)}function resetPage(){$slider.parent().css("overflow",""),$slider.removeClass("slider-contents--animating"),$slider.css("transform","translateX(0%)"),setTimeout(function(){$slider.css("transform","")},10)}function getItemCount(){var w=window.innerWidth;return w>=2300?7:w>=1800?6:w>=1200?5:w>=992?4:w>=768?3:2}function watchAllClick(event){var obj={mode:scope.mode,data:data};"related"==obj.mode?obj.relatedSrc=scope.relatedSrc:"playlist"==obj.mode&&(obj.playlist=scope.playlist),$rootScope.$broadcast(APP_EVENTS.watchAll,obj)}function setViewAllLink(){switch(scope.sref={},scope.mode){case"related":scope.sref.state="app.related",scope.sref.params={id:scope.relatedSrc.id};break;case"trending":scope.sref.state="app.trending",scope.sref.params={};break;default:scope.sref.state="app.playlist",scope.sref.params={slug:scope.playlist.slug}}}function setAriaLabel(){var label;switch(scope.mode){case"related":label="Related Vlips";break;case"trending":label="Trending Vlips";break;default:label=scope.playlist.title+" Vlips"}elem.attr("aria-label",label)}function disableLoader(){angular.element(elem.find(".collection-loader")[0]).remove(),elem.removeClass("loading")}var page=0,itemCount=null,data=scope.related?scope.related.data:null,$slider=angular.element(elem.find(".slider-contents")[0]),$leftArrow=angular.element(elem.find(".slider-left-btn")[0]),$rightArrow=angular.element(elem.find(".slider-right-btn")[0]),init=function(){data?(itemCount=getItemCount(),updateView(),setAriaLabel(),disableLoader()):getData()};elem.on("click",".slider-btn",function(event){var direction=event.currentTarget.getAttribute("data-direction");"next"===direction?page++:page--,scope.$apply(function(){slidePage(direction)}),setTimeout(function(){scope.$apply(function(){resetPage(),updateView()})},850)}),elem.on("click",".watch-all-link",watchAllClick),window.addEventListener("resize",function(){var newCount=getItemCount();newCount!==itemCount&&scope.$apply(function(){itemCount=newCount,updateView()})}),setViewAllLink(),init()}}}])}(),function(){"use strict";angular.module("results").directive("detailBar",[function(){return{restrict:"E",replace:!0,templateUrl:"results/views/detailBar.html",controller:["$scope",function($scope){function getHeaderText(){var obj={};switch($scope.mode){case"search":obj.title=$scope.search.term,obj.count=$scope.search.count;break;case"profile":obj.title=$scope.profile.user.username,obj.count=$scope.profile.vlips.pagination.total_count;break;case"favorites":obj.title="Favorites",obj.count=$scope.favorites.count;break;default:obj.title="",obj.count=""}return obj}$scope.headerTxt=getHeaderText()}],scope:{mode:"@",search:"=",playlists:"=",favorites:"=",profile:"="}}}])}(),function(){"use strict";angular.module("results").directive("playlistsRow",["$document",function($document){return{restrict:"E",templateUrl:"results/views/playlistsRow.html",scope:{list:"="},link:function(scope,elem,attrs){function updateView(){scope.$apply(function(){scope.page==config.totalPages?$rightArrow.addClass("inactive"):$rightArrow.removeClass("inactive"),$row.css("left",-config.pageWidth*scope.page)})}function getPageWidth(){var w=window.innerWidth;return w>=1200?1136:w>=992?938:720}function getConfig(){var obj={pageWidth:getPageWidth(),itemWidth:$item.clientWidth};return obj.numPerPage=Math.floor(obj.pageWidth/obj.itemWidth),obj.totalPages=Math.ceil(scope.list.length/obj.numPerPage)-1,scope.page>obj.totalPages&&(scope.page=obj.totalPages),obj}function getMode(){var w=window.innerWidth;return w>=1200?"lg":w>=992?"md":w>=768?"sm":"xs"}scope.page=0;var $item,config,mode,$row=angular.element(elem.find(".playlists-row")[0]),$rightArrow=angular.element(elem[0].getElementsByClassName("playlist-arrow-right")[0]),init=function(){$item=angular.element($row.find(".playlist-block")[0])[0],config=getConfig(),mode=getMode(),updateView()};angular.element(init),elem.on("click",".playlist-arrow",function(event){"next"===event.currentTarget.getAttribute("data-direction")?scope.page++:scope.page--,updateView()}),window.addEventListener("resize",function(){var newMode=getMode();mode!==newMode&&("xs"===newMode&&(scope.page=0),init())})}}}])}(),function(){"use strict";angular.module("results").directive("resultsGrid",["appProvider",function(appProvider){return{restrict:"E",replace:!0,templateUrl:function(){return appProvider.isMobileBrowser?"results/views/results-mobile.html":"results/views/results.html"},scope:{vlips:"=",profile:"=",term:"=",type:"=",user:"=",activeVlip:"="},controller:"resultsCtrl"}}])}(),function(){"use strict";angular.module("results").directive("vlip",["$rootScope","$state","$timeout","$auth","State","Metrics","Vlips","User","appProvider","APP_EVENTS",function($rootScope,$state,$timeout,$auth,State,Metrics,Vlips,User,appProvider,APP_EVENTS){return{restrict:"E",templateUrl:function(element,attr){return appProvider.isMobileBrowser?"results/views/vlip-mobile.html":"results/views/vlip.html"},scope:{config:"=",hover:"="},controller:"vlipThumbCtrl",link:function(scope,element,attr){function showHoverState(event){event.stopPropagation(),event.preventDefault(),element.off("mouseover",showHoverState),element.on("mouseleave",hideHoverState),void 0==scope.isFavorited&&User.data&&void 0!==User.data.id&&checkFavorite();var soundOn=sessionStorage.getItem("globalSound"),embedURL="/embed/"+scope.config.id+"?sharing=0&thumb=1&sound="+soundOn;$embed.html('<iframe src="'+embedURL+'"></iframe>'),Metrics.vlipViewed(scope.config)}function hideHoverState(event){event.stopPropagation(),element.off("mouseleave",hideHoverState),$elem.addClass("closing"),$embed.html(""),closeShare(),setTimeout(function(){$elem.removeClass("closing"),element.on("mouseover",showHoverState)},1e3)}function openShare(event){event.stopPropagation(),scope.$apply(function(){$shareBtn.parent().addClass("share-open"),$closeShareBtn.on("click",closeShare),$shareBtn.off("click",openShare)})}function closeShare(event){event&&event.stopPropagation(),scope.$apply(function(){$shareBtn.parent().removeClass("share-open"),$closeShareBtn.off("click",closeShare),$shareBtn.on("click",openShare)})}function checkFavorite(){Vlips.favoriteCheck(scope.config.id).then(function(res){scope.isFavorited=res},function(err){})}function favorite(){if($auth.isAuthenticated()){var title=scope.config.from?scope.config.from+": "+scope.config.title:scope.config.title;ga("send","event",scope.favoriteLabel,title+" ["+scope.config.id+"]"),scope.isFavorited=!scope.isFavorited,Vlips.favorite(scope.config.id,scope.isFavorited).then(function(res){scope.isFavorited&&Metrics.vlipFavorited(scope.config),scope.favoriteLabel=scope.isFavorited?"Unfavorite":"Favorite"},function(err){scope.isFavorited=!scope.isFavorited,$rootScope.$broadcast(APP_EVENTS.alert,"somethingWentWrong")})}else State.set($state.current,{slug:scope.config.slug}),$state.go("auth.signin")}function imgLoaded(){$elem.removeClass("preload"),$thumbShade.addClass("loaded")}var $elem=angular.element(element.find(".vlip-item")[0]),$embed=angular.element(element.find(".vlip-thumb-embed")[0]),$img=angular.element(element.find(".vlip-thumb-image")[0]),$thumbShade=angular.element(element.find(".vlip-thumb-shade")[0]),$favoriteBtn=angular.element(element.find(".vlip-favorite-btn")[0]),$shareBtn=angular.element(element.find(".vlip-share-btn")[0]),$closeShareBtn=angular.element(element.find(".close-share-btn")[0]);scope.favoriteLabel="Favorite",element.on("mouseover",showHoverState),$favoriteBtn.on("click",favorite),$shareBtn.on("click",openShare),$img.bind("load",imgLoaded)}}}])}(),function(){"use strict";angular.module("results").filter("getResultsLabel",function(){return function(label){return"vlips"==label?"Created Vlips":label}}),angular.module("results").filter("addTrackingProperties",["PER_PAGE_LIMIT",function(PER_PAGE_LIMIT){return function(results,mode){var initNum=results.pagination.offset*PER_PAGE_LIMIT+1;mode.type&&(mode.type=mode.type.charAt(0).toUpperCase()+mode.type.slice(1));for(var i=0;i<results.data.length;i++){var vlip=results.data[i];vlip.mode=mode,vlip.position=initNum+i}return results}}])}(),function(){"use strict";angular.module("search").controller("searchBarCtrl",["$scope","$state","$timeout","Search","APP_EVENTS",function($scope,$state,$timeout,Search,APP_EVENTS){$scope.quickResponseEnabled=!1,$scope.searchStr=null,$scope.predictiveResults=null,$scope.showPredictive=!1,$scope.focusIndex=null,$scope.focusSearch=!1,$scope.$on(APP_EVENTS.focusSearch,function(event){event.preventDefault(),setTimeout(function(){$scope.focusSearch=!0},300)}),$scope.onBlur=function(){$timeout(function(){$scope.showPredictive=!1,$scope.focusIndex=null,$scope.focusSearch=!1,$scope.$emit(APP_EVENTS.hideSearch,!1)},200)},$scope.keydown=function(event){if($scope.showPredictive&&$scope.predictiveResults){var idx=$scope.focusIndex;38===event.keyCode&&null!==idx?0===idx?$scope.focusIndex=null:$scope.focusIndex--:40===event.keyCode&&idx!=$scope.predictiveResults.data.length-1?null===idx?$scope.focusIndex=0:$scope.focusIndex++:9===event.keyCode&&null!==idx?($scope.focusIndex=null,$scope.searchStr=$scope.predictiveResults.data[idx]):13===event.keyCode&&null!==idx&&$scope.search($scope.predictiveResults.data[idx])}},$scope.search=function(data){$scope.showPredictive=!1,$scope.focusIndex=null,$scope.searchStr=null;var term=$scope.clean(data);document.activeElement!==document.body&&document.activeElement.blur(),$state.go("app.tag",{term:term,raw:data})},$scope.clean=function(term){return term=term.replace(/( )/g,"-"),term=term.replace(/(_)/,"-"),term=term.replace(/[^a-zA-Z0-9-]/g,""),term.toLowerCase()}}])}(),function(){"use strict";angular.module("search").controller("searchCtrl",["$scope","$stateParams","$sce","User","results",function($scope,$stateParams,$sce,User,results){$scope.summary={count:results.pagination.total_count>0?results.pagination.total_count:"no",term:results.term||results.title,tags:results.related_tags},$scope.searchTerm=results.term||results.title,$scope.searchResults=results,$scope.type=results.type,$scope.noResults=0==results.data.length,$scope.user=User.data,$scope.related=null,$scope.failVideo=$sce.trustAsResourceUrl("/embed/kBNCX8S2?sharing=0"),$scope.search=function(data){$state.go("app.search",{term:data})},$scope.submitRelated=function(tags){}}])}(),function(){"use strict";angular.module("search").directive("searchBar",["appProvider","APP_EVENTS",function(appProvider,APP_EVENTS){return{restrict:"E",replace:!0,templateUrl:"search/views/searchBar.html",controller:"searchBarCtrl",link:function(scope,elem,attr){var input=document.getElementById("searchField");if(appProvider.isMobileBrowser){document.getElementById("searchCover").addEventListener("click",function(){input.blur()})}else"/"===location.pathname&&input.focus()}}}])}(),function(){"use strict";angular.module("search").factory("Search",["$http","$q","$window","$rootScope","Metrics","API","PER_PAGE_LIMIT","APP_EVENTS",function($http,$q,$window,$rootScope,Metrics,API,PER_PAGE_LIMIT,APP_EVENTS){var self={getPredictiveResults:function(term){
var deferred=$q.defer();return $http.get(API.url+"/tags/search?q="+term+"&limit=8&key="+API.key,{skipAuthorization:!0}).success(function(res){deferred.resolve(res)}).error(function(err){deferred.reject(err)}.bind(this)),deferred.promise},getResults:function(term,raw,exact,page,limit){var deferred=$q.defer(),count=limit||PER_PAGE_LIMIT,pos=page?page*count:0,url=API.url+"/vlips/search?q="+term+"&safesearch=off&pos="+pos+"&limit="+count+"&key="+API.key+"&related_tags=true";return exact&&(url+="&exact=true"),$http.get(url,{skipAuthorization:!0}).then(function(res){var response=res.data;response.type="search",response.data=self.addColorNums(response.data),response.pagination.limit=count,0==response.pagination.offset&&Metrics.logSearch(term,raw,response.pagination.count),deferred.resolve(response)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},addColorNums:function(vlips){var colorNum=0;return angular.forEach(vlips,function(vlip,idx){colorNum=5==colorNum?1:colorNum+1,vlip.colorNum="c"+colorNum}),vlips}};return self}])}(),function(){"use strict";angular.module("share").controller("embedModalCtrl",["$scope","$sce","$uibModalInstance","$timeout","Metrics","vlip",function($scope,$sce,$uibModalInstance,$timeout,Metrics,vlip){function getEmbedCode(preview){var code='<iframe src="https://vlipsy.com/embed/'+vlip.id;if(($scope.embed.autoloop||$scope.embed.sharing)&&(code+="?",$scope.embed.autoloop&&(code+="loop=1",$scope.embed.sharing&&(code+="&")),$scope.embed.sharing&&(code+="sharing=0")),preview){code+=code.indexOf("?")>-1?"&preview=1":"?preview=1"}return code+='" width="'+$scope.embed.size+'" height="'+Math.round($scope.embed.size/16*9)+'" frameborder="0"></iframe>'}$scope.vlip=vlip,$scope.embed={autoloop:!1,sharing:!1,size:640},$scope.embedHtml=null,$scope.embedCode=null,$scope.copied=!1,$scope.copyEmbedToClipboard=function(event){Metrics.logShare("Embed",vlip),ga("send","event","share","embed",$scope.title+"["+vlip.id+"]"),$scope.copied=!0,$timeout(function(){$scope.copied=!1},3e3)},$scope.$watchCollection("embed",function(){$scope.embedHtml=$sce.trustAsHtml(getEmbedCode(!0)),$scope.embedCode=getEmbedCode()}),$scope.embedHtml=$sce.trustAsHtml(getEmbedCode(!0)),$scope.embedCode=getEmbedCode()}])}(),function(){"use strict";angular.module("shell").controller("alertCenterCtrl",["$scope","$state","APP_EVENTS","DEFAULT_ALERT_TIME","ALERTS","$timeout","Account",function($scope,$state,APP_EVENTS,DEFAULT_ALERT_TIME,ALERTS,$timeout,Account){$scope.alerts=[],$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){for(var i=$scope.alerts.length-1;i>=0;i--)$scope.alerts[i].static||$scope.alerts.splice(i,1)}),$scope.$on(APP_EVENTS.alert,function(event,type){event.preventDefault(),$scope.addAlert(type)}),$scope.addAlert=function(type){var obj=ALERTS[type];if(obj&&($scope.alerts.push(obj),obj.autoClose)){var time=obj.timeoutTime?obj.timeoutTime:DEFAULT_ALERT_TIME;$timeout($scope.removeLastAlert,time)}},$scope.removeLastAlert=function(){$scope.closeAlert($scope.alerts.length-1)},$scope.closeAlert=function(index){$scope.alerts[index].refresh&&window.location.reload();try{$scope.alerts[index].remove=!0,$timeout(function(index){$scope.alerts.splice(index,1)},200)}catch(err){}},$scope.$on(APP_EVENTS.resendVerification,function(event){event.preventDefault(),$scope.resendVerification()}),$scope.resendVerification=function(){$scope.removeLastAlert(),Account.resendVerificationEmail().then(function(email){$scope.addAlert("verifyAccountSend")},function(err){$scope.addAlert("somethingWentWrong")})},$scope.login=function(){$scope.removeLastAlert(),$state.go("auth.signin")}}])}(),function(){"use strict";angular.module("shell").controller("errorPageCtrl",["$scope","$state","$sce",function($scope,$state,$sce){var vlip;switch($state.current.url){case"/500":vlip="DUpf3eM1";break;case"/maintenance":vlip="TLj573Wd";break;default:vlip="WO8pqqbf"}$scope.embedHtml=$sce.trustAsHtml('<iframe src="/embed/'+vlip+'?sharing=0"></iframe>')}])}(),function(){"use strict";angular.module("shell").controller("shellCtrl",["$scope","$rootScope","$state","$timeout","$uibModal","$auth","$filter","State","Vlips","Auth","User","Metrics","APP_EVENTS","AUTH_EVENTS","CREATE_ENABLED",function($scope,$rootScope,$state,$timeout,$uibModal,$auth,$filter,State,Vlips,Auth,User,Metrics,APP_EVENTS,AUTH_EVENTS,CREATE_ENABLED){function getYearCopyright(){return"&copy; "+(new Date).getFullYear()+" Vlipsy, Inc."}function setGlobalSound(){var sound=sessionStorage.getItem("globalSound");return null===sound?(sessionStorage.setItem("globalSound","1"),"1"):sound}function getMobileAppInfo(){var userAgent=navigator.userAgent||navigator.vendor||window.opera,obj={};return/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream?(obj.type="iOS",obj.link="https://itunes.apple.com/app/apple-store/id1288203847?pt=963894&ct=mobile-web&mt=8"):/android/i.test(userAgent)&&(obj.type="Android",obj.link="https://play.google.com/store/apps/details?id=com.vlipsy.android&referrer=utm_source%3Dvlipsy%26utm_medium%3Dbutton%26utm_campaign%3Dmobile-web"),obj}$scope.createEnabled=User.data&&User.data.wkwii||CREATE_ENABLED,$scope.user=User.data,User.data&&($scope.username=User.data.username?User.data.username:User.data._id),$scope.isAuthorized=Auth.isAuthorized,$scope.isScrolled=!1,$scope.copyright=getYearCopyright(),$scope.showLoader=!1,$scope.searchOpen=!1,$scope.quickSearch=!1,$scope.quickSearchEnabled=!1,$scope.innerPage=!1,$scope.mobileMenu=!1,$scope.globalSound=setGlobalSound(),$scope.mobile=getMobileAppInfo(),$scope.$on(AUTH_EVENTS.logoutSuccess,function(event){$scope.user=null}),$scope.$on(APP_EVENTS.userUpdated,function(event){$scope.user=User.data,$scope.username=User.data.username}),$scope.$on(APP_EVENTS.hideSearch,function(event){event.preventDefault(),$scope.searchOpen=!1}),$scope.$on(APP_EVENTS.showLoader,function(event,bool){event.preventDefault(),$scope.searchOpen=!1,$scope.showLoader=bool}),$scope.openCreateModal=function(skipMetrics){if(skipMetrics||Metrics.createButtonClick(),$auth.isAuthenticated()){$uibModal.open({templateUrl:"upload/views/uploadModal.html",controller:"uploadModalCtrl"}).result.then(function(){},function(res){})}else $scope.user=null,State.set($state.current,{upload:!0}),$state.go("auth.signin")},$scope.openTheaterModal=function(obj){$uibModal.open({templateUrl:"results/views/theaterModal.html",controller:"theaterModalCtrl",backdropClass:"modal-shade",windowClass:"theater-modal",size:"lg",resolve:{config:function(){return obj}}}).result.then(function(){})},$scope.showSearch=function(){$scope.searchOpen=!0,$scope.quickSearch=!1},$scope.getApp=function(){window.open($scope.mobile.link),Metrics.getAppClick($scope.mobile.type)},$scope.mobileClick=function(button){if($auth.isAuthenticated()){var state="account"==button?"app.account":"app.upload";$state.go(state)}else $scope.user=null,$state.go("auth.signin")},$scope.backClick=function(){var previous=State.getPrevious();previous&&""!==previous.name?($state.transitionTo(previous.name,previous.params),State.removePrevious()):$state.transitionTo("app.home")},$rootScope.$on("$viewContentLoaded",function(event){$scope.innerPage=-1==$state.current.name.indexOf("app.home")}),$rootScope.$on(APP_EVENTS.newVlip,function(event){$scope.openCreateModal()}),$rootScope.$on(APP_EVENTS.watchAll,function(event,obj){$scope.openTheaterModal(obj)}),$scope.globalSoundToggle=function(){var muted="1"==$scope.globalSound?"0":"1";sessionStorage.setItem("globalSound",muted),$scope.globalSound=muted},$scope.mobile&&$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$scope.mobileMenu=!1}),$state.params.upload&&($scope.openCreateModal(!0),$state.go($state.current.name,{upload:!1},{notify:!1}))}])}(),function(){"use strict";angular.module("shell").directive("alertCenter",["appProvider",function(appProvider){return{restrict:"E",templateUrl:appProvider.isMobileBrowser?"shell/views/alertCenter-mobile.html":"shell/views/alertCenter.html",controller:"alertCenterCtrl",replace:!0}}])}(),function(){"use strict";angular.module("shell").directive("headerNav",[function(){return{restrict:"E",templateUrl:"shell/views/headerNav.html",replace:!0}}])}(),function(){"use strict";angular.module("shell").directive("stickyNav",[function(){return{restrict:"A",link:function(scope,elem,attr){function scrollSpy(){window.pageYOffset>sticky?shell.classList.add("sticky"):shell.classList.remove("sticky")}window.onscroll=function(){scrollSpy()};var shell=document.getElementById("shell"),sticky=shell.offsetTop}}}])}(),function(){"use strict";angular.module("upload").controller("thumbSelectorCtrl",["$scope","$filter","APP_EVENTS","CreatorState",function($scope,$filter,APP_EVENTS,CreatorState){$scope.originalVideo=null,$scope.playerTime=$scope.video.start,$scope.disableDecimalMax=!1,$scope.disableDecimalMin=!1,$scope.vlip=null,$scope.snapVideo=!1,$scope.thumbTime=$scope.video.thumb_time||0,$scope.thumbTimestamp=$filter("timeToString")($scope.thumbTime);var video=document.getElementById("thumbVid"),duration=$scope.video.end-$scope.video.start,ticks=duration/15;$scope.slider={options:{floor:$scope.video.start,ceil:$scope.video.end-.1,showTicks:ticks,step:ticks,precision:1,enforceStep:!1,maxLimit:$scope.video.end-.1,minLimit:$scope.video.start,hideLimitLabels:!0,translate:function(value){var value=value?Number(value).toFixed(1):0,decimal=(value%1).toFixed(1),sec_num=parseInt(value,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds);var time=minutes+":"+seconds;return"00"!==hours&&(time=hours+":"+time),time+=String(decimal).substring(1,3)},onChange:function(sliderId,value,handleLabel){video.currentTime=value}}},$scope.$watch("thumbTime",function(){$scope.thumbTimestamp=$filter("timeToString")($scope.thumbTime),$scope.decimalButtonDisableCheck(),CreatorState.setThumbTime($scope.thumbTime)}),$scope.textChange=function(time){if(!$filter("validateTime")(time))return void($scope.thumbTimestamp=$filter("timeToString")($scope.thumbTime));$scope.thumbTime=$filter("timeToSeconds")(time),video.currentTime=$scope.thumbTime,CreatorState.setThumbTime($scope.thumbTime)},$scope.decimalClick=function(increment){var newTime=increment?parseFloat($scope.thumbTime)+.1:parseFloat($scope.thumbTime)-.1;newTime=parseFloat(newTime).toFixed(1),increment&&newTime+.1==$scope.video.end-.1?newTime=$scope.video.end-.1:!increment&&newTime-.1<$scope.video.start&&(newTime=$scope.video.start),$scope.thumbTime=newTime,video.currentTime=newTime,$scope.decimalButtonDisableCheck(),CreatorState.setThumbTime(newTime)},$scope.decimalButtonDisableCheck=function(){$scope.disableDecimalMax=$scope.thumbTime==$scope.video.end-.1,$scope.disableDecimalMin=$scope.thumbTime==$scope.video.start},$scope.$on(APP_EVENTS.getVideoThumb,function(event){event.preventDefault(),$scope.snapVideo=!0}),$scope.$on(APP_EVENTS.posterReady,function(event,poster){if(poster){var obj={thumb_time:$scope.thumbTime,poster:poster};$scope.snapVideo=!1,$scope.$emit(APP_EVENTS.uploadCallback,obj)}})}])}(),function(){"use strict";angular.module("upload").controller("uploadCtrl",["$scope","$rootScope","$state","$filter","$timeout","$sce","User","Creator","CreatorState","Search","State","appProvider","localStorageService","APP_EVENTS","VIDEO_URL","CREATOR_HEADERS","CREATOR_TIPS","data",function($scope,$rootScope,$state,$filter,$timeout,$sce,User,Creator,CreatorState,Search,State,appProvider,localStorageService,APP_EVENTS,VIDEO_URL,CREATOR_HEADERS,CREATOR_TIPS,data){function init(){if(!appProvider.isMobileBrowser||data.src){var creatorSrc=data.src?data:CreatorState.getSource();creatorSrc?($scope.vidSrc=[{src:creatorSrc.video,type:"video/mp4"}],$scope.video={id:creatorSrc.id,source:creatorSrc.src,start:0,end:null,title:"",thumb_time:0,tags:[],mature:!1,url:creatorSrc.video},CreatorState.set($scope.video,creatorSrc),$scope.clipLoaded=!0):$scope.throwError("uploadBadLink")}}function updateMobileHeader(event,num){var obj=CREATOR_HEADERS[num];CreatorState.mobileStep=num,$timeout(function(){var header={left:{action:obj.left},label:obj.center,right:{action:obj.right.action||obj.right,icon:null,btnLabel:obj.right.btnLabel||obj.right}};1==num&&CreatorState.sourceDuration<30&&(header.left.action="close"),$scope.mobileHeader=header})}function showTip(event,obj){localStorageService.get("hideCreatorTips")||$timeout(function(){$scope.currentTip=CREATOR_TIPS[obj.tip]})}$scope.clipLoaded=!!appProvider.isMobileBrowser&&null,$scope.clipLoading=data.src,$scope.hasError=!1,$scope.durationExceeded=!1,$scope.user=User.data,$scope.submitted=!1,$scope.uploadFail=null,$scope.vlipStep=1,$scope.finalVideoView=!1,$scope.focusTitle=!1,$scope.vlipEmbed=!1,$scope.vlipEmbedTmp=!1,$scope.vidSrc=null,$scope.poster=null,$scope.savingClip=!1,$scope.vid={url:""},$scope.mobile=appProvider.isMobileBrowser,$scope.mobileHeader=null,$scope.prevMobileHeader=null,$scope.currentTip=null,$scope.$on(APP_EVENTS.uploadCallback,function(event,obj){event.stopPropagation(),obj.hasOwnProperty("poster")&&($scope.poster=obj.poster,delete obj.poster,$scope.$apply($scope.setupFinalView())),_.merge($scope.video,obj)}),$scope.setupFinalView=function(){$scope.vlipStep=3,$scope.finalVideoView=!0,$scope.focusTitle=!0,$scope.vlipEmbedTmp&&($scope.vlipEmbed=$scope.vlipEmbedTmp)},$scope.clipVideo=function(){if($scope.video.end-$scope.video.start>30)return void($scope.durationExceeded=!0);$scope.durationExceeded=!1,$scope.$broadcast(APP_EVENTS.getVideoTimes),$scope.vlipStep=2,$scope.video.thumb_time=$scope.video.start,Creator.clipVid($scope.video).then(function(clip){CreatorState.setProgress("clip",!0),$scope.video.vlip_url=clip.url,$scope.vlipEmbedTmp=$sce.trustAsResourceUrl(clip.url),$scope.finalVideoView&&($scope.vlipEmbed=$scope.vlipEmbedTmp),CreatorState.getProgress("thumb")&&$scope.saveThumbnail()},function(e){$scope.throwError("connectionError")}),$timeout(function(){$scope.$broadcast("rzSliderForceRender")})},$scope.saveThumbnail=function(){CreatorState.getProgress("clip")?Creator.createImages().then(function(images){$scope.video.width=images.width,$scope.video.height=images.height,CreatorState.setProgress("thumb",!1),CreatorState.getProgress("finalize")&&$scope.upload()}).catch(function(e){$scope.throwError("connectionError")}):CreatorState.setProgress("thumb",!0),$scope.$broadcast(APP_EVENTS.getVideoThumb)},$scope.getTags=function(term){return null},$scope.upload=function(){return $scope.video.title&&""!=$scope.video.title?$scope.video.from&&""!=$scope.video.from?0==$scope.video.tags.length?void $scope.throwError("uploadTags"):($scope.savingClip=!0,CreatorState.getProgress("thumb")?void CreatorState.setProgress("finalize",!0):($rootScope.$broadcast(APP_EVENTS.showLoader,!0),void Creator.finalizeVlip($scope.video,$scope.user.username).then(function(vlip,user){State.setTrackingData({mode:{type:"Creator"}}),$state.go("app.vlip",{id:vlip.id,slug:vlip.slug,fresh:!0}),CreatorState.destroy()},function(err){$scope.throwError("somethingWentWrong")}))):void $scope.throwError("uploadSource"):void $scope.throwError("uploadTitle")},$scope.throwError=function(type){$rootScope.$broadcast(APP_EVENTS.alert,type)},init(),$scope.processMobile=function(vid){$scope.clipLoading=!0;Creator.getVideoFile(encodeURI(vid.url)).then(function(res){res.src=vid.url,$state.go("app.upload",res,{reload:!0})},function(err){$scope.clipLoading=!1,$scope.hasError=!0})},$scope.mobileHeaderBtnClick=function(action){if("close"==action)$state.go("app.home");else if("next"==action)updateMobileHeader(null,1);else if("back"==action){$scope.vlipStep>0&&$scope.vlipStep--,$scope.finalVideoView=!1,$scope.vlipEmbed=$scope.vlipEmbedTmp=null;var num=CreatorState.mobileStep-1;updateMobileHeader(null,num);var _tip=1==$scope.vlipStep?"clipVideo":"thumb";showTip(null,{tip:_tip})}else"clip"==action?($scope.clipVideo(),updateMobileHeader(null,2),showTip(null,{tip:"thumb"})):"thumb"==action?($scope.saveThumbnail(),updateMobileHeader(null,3),$scope.currentTip=null,$scope.vlipEmbed=$scope.vlipEmbedTmp):"save"==action&&$scope.upload();"next"!=action&&"back"!=action||$scope.$broadcast(APP_EVENTS.creatorNavigation,{direction:action})},$scope.dismissTip=function(permanent){permanent&&localStorageService.set("hideCreatorTips",!0),$scope.currentTip=null},$scope.$on(APP_EVENTS.creatorHeaderChange,updateMobileHeader),$scope.$on(APP_EVENTS.creatorTip,showTip)}])}(),function(){"use strict";angular.module("upload").controller("uploadModalCtrl",["$scope","$rootScope","$uibModalInstance","$state","APP_EVENTS","Creator","User",function($scope,$rootScope,$uibModalInstance,$state,APP_EVENTS,Creator,User){$scope.ready=!0,$scope.hasError=null,$scope.verified=User.data.email_confirmed,$scope.submitting=null,$scope.submit=function(vid){if($scope.submitting=!0,vid&&""!=vid.url){Creator.getVideoFile(encodeURI(vid.url)).then(function(res){$scope.submitting=null,res.src=vid.url,$state.go("app.upload",res),$uibModalInstance.dismiss()},function(err){$scope.hasError=!0,$scope.submitting=null})}},$scope.resendVerification=function(){$rootScope.$broadcast(APP_EVENTS.resendVerification),$uibModalInstance.dismiss()}}])}(),function(){"use strict";angular.module("upload").controller("vlipEditorCtrl",["$scope","$rootScope","$filter","$state","$timeout","CreatorState","APP_EVENTS","VIDEO_THEME","appProvider",function($scope,$rootScope,$filter,$state,$timeout,CreatorState,APP_EVENTS,VIDEO_THEME,appProvider){function translateTooltipLabel(value){var decimal=(value%1).toFixed(1),sec_num=parseInt(value,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds);var time=minutes+":"+seconds;return"00"!==hours&&(time=hours+":"+time),time+String(decimal).substring(1,3)}function onStartDrag(sliderId,start,end,handleLabel){var target="min"===handleLabel?"start":"end";$scope.API.pause(),target!==$scope.decimalTarget&&($scope.decimalTarget=target)}function onDragHandle(sliderId,start,end,handleLabel){"min"===handleLabel&&($scope.API.seekTime(Math.floor(Number(start))),$scope.API.pause()),$scope.limitExceeded=end-start>30}function onEndDrag(sliderId,start,end,handleLabel){"max"===handleLabel?$scope.endChange(end.toFixed(1)):($scope.video.start=$scope.playerTime=start.toFixed(1),$scope.playVideo($scope.video.start)),$scope.decimalButtonDisableCheck()}const MIN_RANGE=1,MAX_RANGE=30,TRIM_PADDING=2;$scope.originalVideo=angular.copy($scope.video),$scope.API=null,$scope.vid={theme:VIDEO_THEME,poster:null},$scope.playerTime=0,$scope.playState=!1,$scope.timestamp={start:"",end:""},$scope.playerTime=0,$scope.playTimer=null,$scope.stopped=!1,$scope.disableDecimalMax={start:!1,end:!0},$scope.disableDecimalMin={start:!0,end:!1},$scope.decimalOpen=!1,$scope.decimalTarget="start",$scope.decimalTxtDisplay=$scope.timestamp.start,$scope.limitExceeded=!1,$scope.sliderStage="start",$scope.bothSlider={min:0,options:{minRange:MIN_RANGE,precision:0,noSwitching:!0,hideLimitLabels:!0,enforceRange:!0,enforceStep:!1,translate:translateTooltipLabel,onStart:onStartDrag,onChange:onDragHandle,onEnd:onEndDrag}},$scope.startSlider={min:0,options:{precision:0,hideLimitLabels:!1,enforceStep:!1,translate:translateTooltipLabel,onStart:onStartDrag,onChange:onDragHandle,onEnd:onEndDrag}},$scope.onPlayerReady=function(API){$scope.API=API,API.mediaElement.attr("playsinline","true")},$scope.onUpdateTime=function(current,total){if(!isNaN(total)){if(0===total)return void $rootScope.$broadcast(APP_EVENTS.alert,"connectionError");if(!$scope.video.end||0==$scope.video.end){if(appProvider.isMobileBrowser){CreatorState.sourceDuration=$scope.video.end;var type=total-current<=MAX_RANGE?"both":"start";$scope.setSliderType(type);var headerNum="both"==type?1:0;$scope.$emit(APP_EVENTS.creatorHeaderChange,headerNum),$scope.startSlider.options.ceil=total-2,$scope.bothSlider.options.maxRange=MAX_RANGE}$scope.bothSlider.options.ceil=total,$scope.video.end=total,$scope.decimalButtonDisableCheck()}$scope.playerTime=current;var timeRemaining=$scope.video.end-current;timeRemaining<1&&null==$scope.playTimer&&$scope.startStopTimer(timeRemaining)}},$scope.onUpdateState=function(state){$scope.stopped="stop"===state},$scope.startStopTimer=function(timeRemaining){$scope.playTimer=$timeout(function(){$scope.vlipPlayComplete()},1e3*timeRemaining)},$scope.togglePlay=function(){"play"===$scope.API.currentState?$scope.API.pause():$scope.API.play()},$scope.restartVlip=function(){$scope.playVideo($scope.video.start)},$scope.playVideo=function(start){$scope.API.seekTime(start),$scope.API.play()},$scope.vlipPlayComplete=function(){$timeout.cancel($scope.playTimer),$scope.playTimer=null,$scope.API.pause(),$scope.API.seekTime($scope.video.start),$scope.playerTime=$scope.video.start,$scope.stopped=!0},$scope.startChange=function(start,fromText){if(fromText){if(!$filter("validateTime")(start))return void($scope.timestamp.start=$filter("timeToString")($scope.video.start));start=$filter("timeToSeconds")(start)}if("both"==$scope.sliderStage){var duration=$scope.video.end-start;duration<MIN_RANGE?start=$scope.video.end-MIN_RANGE:duration>MAX_RANGE&&(start=$scope.video.end-MAX_RANGE)}$scope.playerTime=$scope.video.start=start,$scope.playVideo(start),$scope.limitExceeded=$scope.video.end-$scope.video.start>30},$scope.endChange=function(end,fromText){if(fromText){if(!$filter("validateTime")(end))return void($scope.timestamp.end=$filter("timeToString")($scope.video.end));end=$filter("timeToSeconds")(end)}if(appProvider.isMobileBrowser){var duration=end-$scope.video.start;duration<MIN_RANGE?end=$scope.video.start+MIN_RANGE:duration>MAX_RANGE&&(end=$scope.video.start+MAX_RANGE)}$scope.video.end=end;var adjustedFromEndTime=end-1>$scope.video.start?end-1:$scope.video.start;$scope.playVideo(adjustedFromEndTime),$scope.limitExceeded=$scope.video.end-$scope.video.start>30},$scope.$watch("video.start",function(){$scope.timestamp.start=$scope.video?$filter("timeToString")($scope.video.start):"00:00.0",$scope.decimalTxtDisplay=$scope.timestamp.start}),$scope.$watch("video.end",function(){$scope.timestamp.end=$scope.video?$filter("timeToString")($scope.video.end):"00:00.0",$scope.decimalTxtDisplay=$scope.timestamp.end,$scope.limitExceeded=$scope.video.end-$scope.video.start>30}),$scope.toggleDecimalDisplay=function(target){$scope.decimalTxtDisplay=$scope.timestamp[target],target!=$scope.decimalTarget&&null!=$scope.decimalTarget||($scope.decimalOpen=!$scope.decimalOpen),$scope.decimalTarget=target,$scope.decimalButtonDisableCheck()},$scope.decimalClick=function(increment,target){target&&($scope.decimalTarget=target);var current=parseFloat($scope.video[$scope.decimalTarget]),newTime=increment?current+.1:current-.1;$scope[$scope.decimalTarget+"Change"](newTime.toFixed(1)),$scope.decimalButtonDisableCheck()},$scope.decimalButtonDisableCheck=function(){$scope.disableDecimalMax.start=$scope.video.start==$scope.video.end-MIN_RANGE,$scope.disableDecimalMin.start=0==$scope.video.start;var max=appProvider.isMobileBrowser?$scope.video.start+MAX_RANGE:($scope.API.totalTime/1e3).toFixed(1);$scope.disableDecimalMin.end=$scope.video.end==(Number($scope.video.start)+MIN_RANGE).toFixed(1),$scope.disableDecimalMax.end=$scope.video.end==max},$scope.setSliderType=function(type){if("both"==type){var duration=$scope.video.end-$scope.video.start;duration<10&&($scope.bothSlider.options.step=duration/20,$scope.bothSlider.options.precision=2),$scope.$emit(APP_EVENTS.creatorTip,{tip:"clipVideo"})}else $scope.$emit(APP_EVENTS.creatorTip,{tip:"startingPoint"});$scope.sliderStage=type,$scope.decimalButtonDisableCheck(),$timeout(function(){$scope.$broadcast("rzSliderForceRender")})},$scope.$on(APP_EVENTS.creatorNavigation,function(event,obj){if($scope.API.seekTime($scope.video.start),$scope.API.pause(),"next"!=obj.direction||"both"!=$scope.sliderStage){var newSlider=0==CreatorState.mobileStep?"start":"both";if("both"==newSlider){var duration=$scope.video.end-$scope.video.start;duration>MAX_RANGE&&($scope.video.end=Number($scope.video.start)+MAX_RANGE),$scope.bothSlider.options.ceil=duration<=MAX_RANGE?$scope.video.end:$scope.video.end+TRIM_PADDING,$scope.bothSlider.options.floor=$scope.video.start<TRIM_PADDING?0:$scope.video.start-TRIM_PADDING}$scope.setSliderType(newSlider)}}),$scope.$on(APP_EVENTS.getVideoTimes,function(event){$scope.API.seekTime($scope.video.start),$scope.API.pause(),CreatorState.setClipTime($scope.video.start,$scope.video.end),event.preventDefault(),$scope.$emit(APP_EVENTS.uploadCallback,$scope.video),$scope.sliderStage=null}),$scope.$watch("poster",function(event){angular.isUndefined($scope.poster)||($scope.vid.poster=$scope.poster,$scope.stopped=!0)}),appProvider.isMobileBrowser&&($scope.decimalTarget="start")}])}(),function(){"use strict";angular.module("upload").directive("thumbSelector",["APP_EVENTS","$sce",function(APP_EVENTS,$sce){return{restrict:"E",replace:!0,templateUrl:"upload/views/thumbSelector.html",controller:"thumbSelectorCtrl",scope:{video:"=",vidSrc:"="},link:function(scope,element,attrs){function init(){vidElem.removeEventListener("loadeddata",init,!1),vidElem.currentTime=scope.video.thumb_time}var vidElem=document.getElementById("thumbVid");vidElem.addEventListener("loadeddata",init,!1),scope.$watch("vidSrc",function(newValue,oldValue){if(newValue){var source=vidElem.getElementsByTagName("source")[0];vidElem.setAttribute("crossOrigin","anonymous"),source.setAttribute("src",$sce.trustAsResourceUrl(scope.vidSrc[0].src)),source.setAttribute("type","video/mp4"),vidElem.load()}}),scope.$watch("snapVideo",function(){if(scope.snapVideo){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");setTimeout(function(){var cw=vidElem.clientWidth,ch=vidElem.clientHeight,y=-(ch/2-195);canvas.width=cw,canvas.height=ch,ctx.drawImage(vidElem,0,y,cw,ch);var poster=canvas.toDataURL("image/jpeg",1);scope.$emit(APP_EVENTS.posterReady,poster)},50)}})}}}])}(),function(){"use strict";angular.module("upload").directive("vlipEditor",["appProvider",function(appProvider){return{restrict:"E",replace:!0,templateUrl:appProvider.isMobileBrowser?"upload/views/vlipEditor-mobile.html":"upload/views/vlipEditor.html",controller:"vlipEditorCtrl",scope:{video:"=",vidSrc:"=",final:"=",poster:"="},link:function(scope,element,attrs){if(appProvider.isMobileBrowser){var height=window.innerWidth/16*9;element[0].getElementsByClassName("vlip")[0].setAttribute("style","min-height: "+height+"px")}}}}])}(),function(){"use strict";angular.module("upload").directive("vlipPreview",["appProvider",function(appProvider){return{restrict:"E",replace:!0,templateUrl:"upload/views/vlipPreview.html",scope:{video:"="},link:function(scope,elem,attrs){function init(){video.setAttribute("width",width),video.setAttribute("height",height),video.load(),4!==video.readyState?(video.addEventListener("canplaythrough",videoLoaded,!1),video.addEventListener("load",videoLoaded,!1)):videoLoaded()}function toggleMuteState(event){if(event.preventDefault(),event.stopPropagation(),_webview)return video.currentTime=0,void video.play();video.muted?(player.classList.remove("muted"),rewindVideo()):player.classList.add("muted"),video.muted=!video.muted,player.classList.add("badge"),setTimeout(function(){player.classList.remove("badge")},300)}function loopVideo(event){video.muted||_loopCount++,_loopCount<_maxLoops?video.play():(video.muted=!0,player.classList.add("muted"),_loopCount=0,video.play())}function rewindVideo(){_loopCount=0,video.currentTime=0,video.play()}function videoLoaded(){video.removeEventListener("canplaythrough",videoLoaded,!1),video.removeEventListener("load",videoLoaded,!1),video.muted=!0,video.play(),setTimeout(function(){loader.parentNode.removeChild(loader),player.classList.remove("loading"),video.paused&&(video.removeAttribute("playsinline"),player.classList.add("webview"),_webview=!0,video.muted=!1)},300)}var width=appProvider.isMobileBrowser?window.innerWidth:640,height=9*Math.round(width/16);elem[0].setAttribute("style","min-height:"+height+"px");var player=elem[0].getElementsByClassName("vlipsy-video-player")[0],video=player.getElementsByClassName("video")[0],loader=player.getElementsByClassName("video-loader")[0],muteBtn=document.getElementById("mute-cover"),_loopCount=0,_maxLoops=3,_webview=(/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream,!1);video.addEventListener("ended",loopVideo),muteBtn.addEventListener("click",toggleMuteState),init()}}}])}(),function(){"use strict";angular.module("upload").filter("addTimeSpacing",function(){return function(timestamp){var spacedOutTime="<span>"+timestamp.slice(0,2)+"</span> : <span>"+timestamp.slice(3,5)+"</span>";return timestamp.length>7&&(spacedOutTime+=" : <span>"+timestamp.slice(6,8)+"</span>"),spacedOutTime+" . <span>"+timestamp.slice(-1)+"</span>"}}),angular.module("vlipsyApp").filter("timeToString",function(){return function(time,omitDecimal){var value=time?Number(time).toFixed(1):0,decimal=(value%1).toFixed(1),sec_num=parseInt(value,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds);var time=minutes+":"+seconds;return"00"!==hours&&(time=hours+":"+time),omitDecimal||(time+=String(decimal).substring(1,3)),time}}),angular.module("vlipsyApp").filter("timeToSeconds",function(){return function(timeStr){for(var arr=timeStr.split(":"),sec=0,min=1;arr.length>0;)sec+=min*Number(arr.pop()),min*=60;return sec}}),angular.module("vlipsyApp").filter("validateTime",function(){return function(time){return/^(?:(\d{1,2}):)?(\d{1,2}):(\d{2})(?:(\.\d{1}))?$/.test(time)}}),angular.module("vlipsyApp").filter("getYoutubeID",function(){return function(str){if(RegExp(/^[\w]+$/).test(str)&&11===str.length)return str;var match=str.match(/(\?|&)v\=([\w-]{11})/);if(null!==match&&void 0!==match[2])return match[2];if(str.indexOf("youtu.be/")>-1){var n=str.indexOf("youtu.be/");return str.substring(n+9,str.length)}return null}}),angular.module("vlipsyApp").filter("getFacebookVideoID",function(){return function(url){if(-1===url.indexOf("/videos/"))return null;var start=url.indexOf("/videos/")+8;return url.substring(start,url.length-1).replace("/","")}})}(),function(){"use strict";angular.module("upload").factory("Creator",["$http","$q","$window","$filter","Metrics","CreatorState","User","SERVICE_URL","VIDEO_URL","YOUTUBE_API_KEY","API",function($http,$q,$window,$filter,Metrics,CreatorState,User,SERVICE_URL,VIDEO_URL,YOUTUBE_API_KEY,API){var creatorService={getVideoFile:function(source){var deferred=$q.defer();return $http.post(API.url+"/vlips?key="+API.key,{source:source}).then(function(res){console.timeEnd("download"),deferred.resolve(res.data)},function(res){deferred.reject(res.data)}.bind(this)),deferred.promise},clipVid:function(vid){var deferred=$q.defer(),obj={start:vid.start,end:vid.end,video:vid.url};return $http.put(API.url+"/vlips/"+vid.id+"/clip?key="+API.key,obj).then(function(res){console.timeEnd("clip"),deferred.resolve(res.data)},function(res){deferred.reject(res.data)}.bind(this)),deferred.promise},finalizeVlip:function(vlip,username){var deferred=$q.defer(),obj={title:vlip.title,from:vlip.from,tags:creatorService.prepTags(vlip.tags)};return $http.put(API.url+"/vlips/"+vlip.id+"/metadata?key="+API.key,obj).then(function(res){console.timeEnd("mongo"),Metrics.vlipCreated(vlip.id,username),deferred.resolve(res.data)},function(res){deferred.reject(res.data)}.bind(this)),deferred.promise},createImages:function(){var vid=CreatorState.get(),deferred=$q.defer(),thumb_time=vid.thumb_time-vid.start;return $http.put(API.url+"/vlips/"+vid.id+"/thumbnail?key="+API.key,{time:thumb_time.toFixed(2)}).then(function(res){console.timeEnd("images"),
deferred.resolve(res.data)},function(res){deferred.reject(res.data)}.bind(this)),deferred.promise},prepTags:function(tags){if(!tags)return tags;if(_.isObject(tags[0])){var arr=[];return angular.forEach(tags,function(value,key){arr.push(value.text.replace(/[^\w\s]/g,"").toLowerCase())}),arr}return tags},validateVideo:function(url){var deferred=$q.defer(),data={id:null},source=-1===url.indexOf("facebook")?"getYoutubeID":"getFacebookVideoID",sourceType=-1===url.indexOf("facebook")?"youtube":"facebook";if(data.id=$filter(source)(url),data.status=null!==data.id,!data.status)return deferred.reject(data),deferred.promise;if("youtube"===sourceType){var url="https://www.googleapis.com/youtube/v3/videos?part=id&id="+data.id+"&key="+YOUTUBE_API_KEY;$http.get(url,{skipAuthorization:!0}).then(function(res){res.data.status=res.data.items.length>0,deferred.resolve(res.data)},function(res){deferred.reject(res.data)}.bind(this))}else $http.get(url,{skipAuthorization:!0}).then(function(res){deferred.resolve(res.data)},function(res){deferred.reject(res.data)}.bind(this));return deferred.promise}};return creatorService}])}(),function(){"use strict";angular.module("vlipsyApp").service("CreatorState",function(){return this.vlip=null,this.progress={clip:!1,thumb:!1,finalize:!1},this.mobileStep=0,this.sourceDuration=null,this.set=function(vlip,source){sessionStorage.setItem("creatorVlip",JSON.stringify(source)),this.vlip=vlip},this.get=function(){return this.vlip},this.getSource=function(){return JSON.parse(sessionStorage.getItem("creatorVlip"))},this.setClipTime=function(start,end){this.vlip.start=start,this.vlip.end=end},this.setThumbTime=function(time){this.vlip.thumb_time=time},this.setProgress=function(prop,val){this.progress[prop]=val},this.getProgress=function(prop){return this.progress[prop]},this.setMobileState=function(increment){increment?this.mobileStep++:this.mobileStep--},this.destroy=function(){sessionStorage.removeItem("creatorVlip"),this.vlip=null},this})}(),function(){"use strict";angular.module("vlip").controller("vlipProfileCtrl",["$scope","$rootScope","$state","$sce","$filter","$timeout","$uibModal","$window","$auth","MetaData","Metrics","State","User","Vlips","SERVICE_URL","SOCIAL_APPS","APP_EVENTS","vlip","favorited","related","CREATE_ENABLED",function($scope,$rootScope,$state,$sce,$filter,$timeout,$uibModal,$window,$auth,MetaData,Metrics,State,User,Vlips,SERVICE_URL,SOCIAL_APPS,APP_EVENTS,vlip,favorited,related,CREATE_ENABLED){function favoriteCheck(id){Vlips.favoriteCheck(id).then(function(res){$scope.isFavorited=res})}function loadNewVlipInfo(newVlip,index){var trackingData={type:"Related",source:$scope.vlip.id,gesture:"Swipe"};$scope.title=newVlip.source?newVlip.source+": "+newVlip.title:newVlip.title,$state.go("app.vlip",{slug:newVlip.slug,mode:trackingData,position:index,swipe:!0},{notify:!1}),Vlips.getVlipByID(newVlip.id,!0).then(function(res){$scope.activeVlip=res,res.creator&&setAvatar(res.creator),$scope.user&&favoriteCheck(newVlip.id)},function(err){$rootScope.$broadcast(APP_EVENTS.alert,"somethingWentWrong")})}function setAvatar(creator){$scope.creator=creator,$scope.creatorImg=creator.avatar}function recordVlipViewData(e){window.document.removeEventListener("VlipViewData",recordVlipViewData)}$scope.createEnabled=User.data&&User.data.wkwii||CREATE_ENABLED,$scope.baseURL=SERVICE_URL,$scope.vlip=angular.copy(vlip),$scope.activeVlip=angular.copy(vlip),$scope.title=$scope.vlip.from?$scope.vlip.from+": "+$scope.vlip.title:$scope.vlip.title;var soundOn=sessionStorage.getItem("globalSound");$scope.embedHtml=$sce.trustAsHtml('<iframe id="vlipMain" src="/embed/'+vlip.id+"?sharing=0&sound="+soundOn+'"></iframe>'),$scope.schemaUrl=$sce.trustAsResourceUrl(window.location.hostname+vlip.id),$scope.description=MetaData.getPageDescription(),$scope.showSharePanel=!1,$scope.copyEmbed='<iframe width="640" height="360" src="https://'+window.location.hostname+"/embed/"+vlip.id+'" frameborder="0" allowfullscreen></iframe>',$scope.copyLink=vlip.short_url,$scope.user=User.data,$scope.isFavorited=!0===favorited,$scope.favoriteLabel=!0===favorited?"Unfavorite":"Favorite",$scope.carouselData=angular.copy(related.data),$scope.carouselData.unshift(vlip),$scope.showRelated=related.data.length>0,$scope.relatedTitle="More like this "+vlip.from+" video clip",$scope.relatedVlips=related,$scope.relatedVlips.source=vlip,$scope.relatedIndex=0,$scope.metaOpen=!1,$scope.creator=vlip.creator,$scope.creatorImg=vlip.creator.avatar,$scope.showReport=!1,$scope.copied=!1,$scope.removed=1===vlip.dmca,$scope.metricObj={vlip:angular.copy(vlip),mode:{type:"vlip"},position:$state.params.position},$scope.isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,$scope.sourceLink="https://youtube.com/watch?v="+$filter("getYoutubeID")(vlip.source),$scope.sourceLinkWithStart=$scope.sourceLink+"&t="+Math.round(vlip.start)+"s",$scope.swipeChange=function(){$scope.activeVlip=null,$scope.$broadcast(APP_EVENTS.swipeChange)},$scope.$watch("relatedIndex",function(newValue,oldValue){newValue!==oldValue&&loadNewVlipInfo($scope.carouselData[newValue],newValue)}),$scope.sendSMS=function(){Metrics.logShare("Mms",vlip);var param=$scope.isIOS?"&":"?";location.href="sms:"+param+"body="+encodeURIComponent($scope.vlip.short_url)},$scope.copyLinkToClipboard=function(event){Metrics.logShare("Link",vlip),ga("send","event","share","copy-link",$scope.title+"["+vlip.id+"]"),$scope.copied=!0,$timeout(function(){$scope.copied=!1},3e3)},$scope.clipError=function(event){},$scope.facebookShare=function(){Metrics.logShare("Facebook",vlip);var url="http://www.facebook.com/sharer/sharer.php?u="+$scope.vlip.short_url;return $window.open(url,SOCIAL_APPS.facebook,"width=650,height=335,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0"),!1},$scope.twitterShare=function(){Metrics.logShare("Twitter",vlip);var url="http://twitter.com/share?url="+$scope.activeVlip.short_url+"&via=VlipsyApp";return $window.open(url,SOCIAL_APPS.twitter,"width=650,height=260,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0"),!1},$scope.pinterestShare=function(){Metrics.logShare("Pinterest",vlip);var url="http://www.pinterest.com/pin/create/button/?url="+$scope.vlip.short_url+"&media="+vlip.media.preview.url+"&is_video=true&description="+$scope.title+" - Vlipsy.com";return $window.open(url,SOCIAL_APPS.pinterest,"width=750,height=550,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0"),!1},$scope.tumblrShare=function(){Metrics.logShare("Tumblr",vlip);var tags=$filter("arrayToCommaSeparatedString",vlip.tags),params="canonicalUrl="+encodeURIComponent($scope.vlip.short_url)+"&content="+encodeURIComponent("https://"+window.location.hostname+"/embed/"+vlip.id)+"&caption="+encodeURIComponent('(via <a href="'+$scope.vlip.short_url+'">Vlipsy</a>)')+"&clickthroughUrl="+encodeURIComponent($scope.vlip.short_url)+"&posttype=video&tags=vlipsy"+encodeURIComponent(","+tags);return $window.open("http://www.tumblr.com/widgets/share/tool?"+params,"","width=750,height=650,toolbar=0,menubar=0,location=0,status=0,scrollbars=1,resizable=1,left=0,top=0"),!1},$scope.redditShare=function(){Metrics.logShare("Reddit",vlip);var url="http://www.reddit.com/submit?url="+$scope.vlip.short_url+"&title="+$scope.title+" - Vlipsy.com";return $window.open(url,"","width=750,height=650,toolbar=0,menubar=0,location=0,status=0,scrollbars=1,resizable=1,left=0,top=0"),!1},$scope.messengerShare=function(){Metrics.logShare("Messenger",vlip);var url="http://www.facebook.com/dialog/send?app_id="+SOCIAL_APPS.facebook+"&link="+$scope.vlip.short_url+"&redirect_uri="+$scope.vlip.short_url;return $window.open(url,SOCIAL_APPS.facebook),!1},$scope.download=function(){Metrics.logShare("Download",vlip),ga("send","event","download",$scope.title+" ["+vlip.id+"]"),Vlips.download(vlip.id)},$scope.favorite=function(){$auth.isAuthenticated()?(ga("send","event",$scope.favoriteLabel,$scope.title+" ["+vlip.id+"]"),$scope.isFavorited=!$scope.isFavorited,Vlips.favorite(vlip.id,$scope.isFavorited).then(function(res){$scope.isFavorited&&Metrics.vlipFavorited(vlip),$scope.favoriteLabel=$scope.isFavorited?"Unfavorite":"Favorite"},function(err){$scope.isFavorited=!$scope.isFavorited,$rootScope.$broadcast(APP_EVENTS.alert,"somethingWentWrong")})):(State.set($state.current,{slug:vlip.slug}),$state.go("auth.signin"))},$scope.tagClick=function(tag){Metrics.tagViewed(tag,$scope.metricObj),$state.go("app.tag",{term:$filter("hyphenate")(tag)})},$scope.openEmbedModal=function(){$uibModal.open({templateUrl:"share/views/embedModal.html",controller:"embedModalCtrl",backdropClass:"modal-shade",windowClass:"embed-modal",resolve:{vlip:function(){return $scope.vlip}}}).result.then(function(){})},$scope.report=function(){},$scope.memeClick=function(){$uibModal.open({templateUrl:"meme/views/memeTool.html",controller:"memeToolCtrl",backdropClass:"meme",backdrop:"static",windowClass:"meme-tool",size:"lg",resolve:{vlip:function(){return $scope.vlip}}}).result.then(function(){},function(res){})},$scope.sourceClick=function(){ga("send","event","click","source-click",$scope.vlip.vid_url),Metrics.vlipSourceClick(vlip)},$scope.slickInit=function(event){$scope.slickReady=!0},$scope.featureClick=function(url){Metrics.vlipContextClick(vlip,url)},window.document.addEventListener("VlipViewData",recordVlipViewData)}])}(),function(){"use strict";angular.module("vlip").directive("embedPlayer",function(){return{restrict:"E",replace:!0,template:'<div class="embed-wrapper" ng-bind-html="embedHtml"></div>',scope:{source:"=",favorited:"=",user:"="},controller:["$scope","$sce",function($scope,$sce){$scope.embedHtml=$sce.trustAsHtml('<iframe src="/embed/'+$scope.source.id+'?sharing=0&preview=1"></iframe>')}]}})}(),function(){"use strict";angular.module("vlip").directive("videoPlayer",["$rootScope","MobilePlayer","Vlips","Metrics","APP_EVENTS",function($rootScope,MobilePlayer,Vlips,Metrics,APP_EVENTS){return{restrict:"E",replace:!0,templateUrl:"vlip/views/mobile-video-player.html",scope:{source:"=",favorited:"=",user:"="},link:function(scope,elem,attrs){function toggleMuteState(event){if(event.preventDefault(),event.stopPropagation(),_webview)return video.currentTime=0,video.play(),void Metrics.vlipUnmuted(scope.source);video.muted?(elem[0].classList.remove("muted"),rewindVideo(),Metrics.vlipUnmuted(scope.source)):(elem[0].classList.add("muted"),checkBounce()),video.muted=!video.muted,elem[0].classList.add("badge"),setTimeout(function(){elem[0].classList.remove("badge")},300)}function loopVideo(event){video.muted||1===++_loopCount&&checkBounce(),_loopCount<_maxLoops?video.play():(video.muted=!0,MobilePlayer.setMuteState(video.muted),elem[0].classList.add("muted"),_loopCount=0,video.play(),checkBounce())}function checkBounce(){MobilePlayer.getHintState()||(bounceSwipeHint(),MobilePlayer.setHintState(!0))}function bounceSwipeHint(){document.getElementsByClassName("slick-track")[0].classList.add("bounce"),setTimeout(function(){document.getElementsByClassName("slick-track")[0].classList.remove("bounce")},1500)}function rewindVideo(event){event&&(event.preventDefault(),event.stopPropagation()),_loopCount=0,video.currentTime=0,video.play()}function onSwipeChange(){MobilePlayer.incrementSwipeCount(),video.pause(),removeListeners()}function removeListeners(){video.parentNode.removeChild(video),deregisterListener(),document.removeEventListener("onfullscreenchange",fullScreenChange),video.removeEventListener("ended",loopVideo),muteBtn.removeEventListener("click",toggleMuteState),video.removeEventListener("canplaythrough",videoLoaded,!1),video.removeEventListener("load",videoLoaded,!1)}function videoLoaded(){video.removeEventListener("canplaythrough",videoLoaded,!1),video.removeEventListener("load",videoLoaded,!1),video.muted=!0,video.play(),setTimeout(function(){loader.parentNode.removeChild(loader),elem[0].classList.remove("loading"),video.paused&&(video.removeAttribute("playsinline"),elem[0].classList.add("webview"),_webview=!0,video.muted=!1,document.addEventListener("onfullscreenchange",fullScreenChange))},300)}function fullScreenChange(event){checkBounce()}function favorite(){var fav=!scope.favorited;scope.favorited=fav,Vlips.favorite(scope.source.id,fav).then(function(){},function(){scope.fav=!fav,$rootScope.$broadcast(APP_EVENTS.alert,"somethingWentWrong")})}function init(){video.load(),4!==video.readyState?(video.addEventListener("canplaythrough",videoLoaded,!1),video.addEventListener("load",videoLoaded,!1)):videoLoaded(),MobilePlayer.getSwipeCount()>14&&_ios&&setTimeout(function(){location.reload(!1)},1e3)}var video=elem[0].getElementsByClassName("video")[0],loader=elem[0].getElementsByClassName("video-loader")[0],muteBtn=document.getElementById("mute-cover"),favBtn=elem[0].getElementsByClassName("fav-btn")[0],_loopCount=0,_maxLoops=3,_ios=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,_webview=!1;MobilePlayer.data||MobilePlayer.init(),favBtn&&favBtn.addEventListener("click",favorite);var deregisterListener=scope.$on(APP_EVENTS.swipeChange,onSwipeChange);if(video.addEventListener("ended",loopVideo),muteBtn.addEventListener("click",toggleMuteState),scope.source)init();else var unregister=scope.$watch("source",function(){scope.source&&(init(),unregister())})}}}])}(),function(){"use strict";angular.module("vlip").filter("getDurationLabel",function(){return function(config){config.start||(config.start=0);var total=parseInt(config.end-config.start),sec_num=parseInt(total,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;return hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),"00"==hours?minutes+":"+seconds:hours+":"+minutes+":"+seconds}})}(),function(){"use strict";angular.module("vlip").service("MobilePlayer",function(){return this.init=function(){this.data={muted:!0,hinted:!1,count:0}},this.setMuteState=function(bool){this.data.muted=bool},this.getMuteState=function(bool){return this.data.muted},this.setHintState=function(bool){this.data.hinted=bool},this.getHintState=function(bool){return this.data.hinted},this.incrementSwipeCount=function(){this.data.count++},this.getSwipeCount=function(){return this.data.count},this})}(),function(){"use strict";angular.module("vlip").factory("Vlips",["$http","$q","$filter","$window","$rootScope","User","Metrics","API","PER_PAGE_LIMIT","SERVICE_URL","APP_EVENTS",function($http,$q,$filter,$window,$rootScope,User,Metrics,API,PER_PAGE_LIMIT,SERVICE_URL,APP_EVENTS){var self=(API.url,API.version,{get:function(safesearch,page,limit){var deferred=$q.defer(),rating=safesearch||"low",count=limit||PER_PAGE_LIMIT,pos=page?page*count:0;return $http.get(API.url+"/vlips/trending?safesearch="+rating+"&limit="+count+"&pos="+pos+"&key="+API.key).then(function(res){var response=res.data;response.data=self.addColorNums(response.data),response.type="recent",response.pagination.limit=count;var results=$filter("addTrackingProperties")(response,{type:"trending"});deferred.resolve(results)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},getVlipByID:function(id,swipe){var deferred=$q.defer();return $http.get(API.url+"/vlips/"+id+"?key="+API.key).success(function(res){deferred.resolve(res.data)}).error(function(err){deferred.reject(err)}.bind(this)),deferred.promise},getVlipCreator:function(id){var deferred=$q.defer();return $http.get(API.url+"/users/"+id+"?key="+API.key).success(function(res){deferred.resolve(res.data)}).error(function(err){deferred.reject(err)}.bind(this)),deferred.promise},getPlaylists:function(){var deferred=$q.defer();return $http.get(API.url+"/playlists?key="+API.key).success(function(res){deferred.resolve(res)}).error(function(err){deferred.reject(err)}.bind(this)),deferred.promise},getPlaylistInfo:function(id){var deferred=$q.defer();return $http.get(API.url+"/playlists/"+id+"?key="+API.key).then(function(res){deferred.resolve(res.data)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},getPlaylistVlips:function(playlist,page,limit){var deferred=$q.defer(),count=limit||PER_PAGE_LIMIT,pos=page?page*count:0;return $http.get(API.url+"/playlists/"+playlist.id+"/vlips?pos="+pos+"&limit="+count+"&key="+API.key).then(function(res){var response=res.data;response.data=self.addColorNums(response.data),response.pagination.limit=count;var results=$filter("addTrackingProperties")(response,{type:"playlist",source:playlist.title});deferred.resolve(results)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},download:function(id){window.location.href=SERVICE_URL+"/vlip/dl/"+id},getFavorites:function(username,page,limit){var deferred=$q.defer(),offset=page||0,count=limit||PER_PAGE_LIMIT;return $http.get(API.url+"/users/"+username+"/favorites?limit="+count+"&pos="+offset+"&key="+API.key).then(function(res){var results=res.data;results.data=self.addColorNums(results.data),results.pagination.limit=count,deferred.resolve(results)},function(err){deferred.reject(err)}.bind(this)),deferred.promise},favorite:function(id,status){var deferred=$q.defer();return(status?$http.put(API.url+"/user/favorites/"+id+"?key="+API.key):$http.delete(API.url+"/user/favorites/"+id+"?key="+API.key)).success(function(res){deferred.resolve(res)}).error(function(err){deferred.reject(err)}.bind(this)),deferred.promise},favoriteCheck:function(id){var deferred=$q.defer();return $http.get(API.url+"/user/favorites/"+id+"?key="+API.key).success(function(res){deferred.resolve(res)}).error(function(err){deferred.reject(err)}.bind(this)),deferred.promise},getRelatedVlips:function(id){var deferred=$q.defer();return $http.get(API.url+"/vlips/"+id+"/related?key="+API.key).success(function(res){deferred.resolve(res)}).error(function(err){deferred.reject(err)}.bind(this)),deferred.promise},addColorNums:function(vlips){var colorNum=0;return angular.forEach(vlips,function(vlip,idx){colorNum=5==colorNum?1:colorNum+1,vlip.colorNum="c"+colorNum}),vlips}});return self}])}();